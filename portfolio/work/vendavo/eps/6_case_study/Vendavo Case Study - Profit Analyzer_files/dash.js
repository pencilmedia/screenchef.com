(function(){var g={};
(function(window){var k,aa=this;function p(a,b){var c=a.split("."),d=aa;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d[e]?d=d[e]:d=d[e]={}:d[e]=b}function q(a,b){function c(){}c.prototype=b.prototype;a.Zb=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Yb=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}};/*

 Copyright 2015 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function ba(a,b){this.id=a;this.lang=b||"unknown";this.enabled=this.active=!1}p("shaka.player.TextTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:0});function ca(){this.minBandwidth=this.maxBandwidth=this.maxWidth=this.minHeight=this.maxHeight=null}ca.prototype.clone=function(){var a=new ca;a.maxHeight=this.maxHeight;a.minHeight=this.minHeight;a.maxWidth=this.maxWidth;a.maxBandwidth=this.maxBandwidth;a.minBandwidth=this.minBandwidth;return a};function da(a,b,c,d){this.id=a;this.bandwidth=b||0;this.width=c||0;this.height=d||0;this.active=!1}function ea(a,b){var c=a.width*a.height,d=b.width*b.height;return c<d?-1:c>d?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0}p("shaka.player.VideoTrack.compare",ea);function fa(a,b,c){this.id=a;this.bandwidth=b||0;this.lang=c||"unknown";this.active=!1}p("shaka.player.AudioTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0});function r(){var a,b,c=new Promise(function(c,e){a=c;b=e});c.resolve=a;c.reject=b;c.destroy=r.prototype.destroy;return c}r.prototype.destroy=function(){this.catch(function(){});var a=Error("Destroyed!");a.type="destroy";this.reject(a)};function u(a,b){return b.bind(a)};function ga(a){return Object.keys(a).map(function(b){return a[b]})}function ha(a,b){return ia(a,b,"boolean")}function ja(a,b){var c=ia(a,b,"number");if(null==c)return null;if(isNaN(c)||c==Number.NEGATIVE_INFINITY||c==Number.POSITIVE_INFINITY)throw new RangeError("'"+b+"' must be finite.");if(0>c)throw new RangeError("'"+b+"' must be >= 0");return c}function ka(a,b){return ia(a,b,"string")}
function ia(a,b,c){a=a[b];if(null==a)return null;if(typeof a!=c)throw new TypeError("'"+b+"' must be a "+c+".");return a}function la(a,b,c){a=a[b];if(null==a)return null;if(!(a instanceof c))throw new TypeError("'"+b+"' must be an instance of "+c.name+".");return a};function ma(a){return a.split("").reduce(function(a,c,d){return a+(d&&0==d%4?" "+c:c)})};function na(a,b){for(var c=[],d=0;d<a.length;++d){for(var e=!1,f=0;f<c.length&&!(e=b?b(a[d],c[f]):a[d]===c[f]);++f);e||c.push(a[d])}return c};var oa={"output-restricted":"The required output protection is not available.","output-not-allowed":"The required output protection is not available.",expired:"The decryption key has expired.","internal-error":"The key system has encountered an unspecified error."};function qa(a){return String.fromCharCode.apply(null,a)}p("shaka.util.Uint8ArrayUtils.toString",qa);function ra(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}p("shaka.util.Uint8ArrayUtils.fromString",ra);p("shaka.util.Uint8ArrayUtils.toBase64",function(a,b){var c=void 0==b?!0:b,d=window.btoa(qa(a)).replace(/\+/g,"-").replace(/\//g,"_");return c?d:d.replace(/=*$/,"")});function sa(a){return ra(window.atob(a.replace(/-/g,"+").replace(/_/g,"/")))}
p("shaka.util.Uint8ArrayUtils.fromBase64",sa);p("shaka.util.Uint8ArrayUtils.fromHex",function(a){for(var b=new Uint8Array(a.length/2),c=0;c<a.length;c+=2)b[c/2]=window.parseInt(a.substr(c,2),16);return b});function ta(a){for(var b="",c=0;c<a.length;++c){var d=a[c].toString(16);1==d.length&&(d="0"+d);b+=d}return b}p("shaka.util.Uint8ArrayUtils.toHex",ta);function ua(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0};function va(a){this.b=a;this.a=new wa(a);xa||(xa=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var xa;
function v(a){var b;b=ya(a);if(7<b.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var c=0,d=0;d<b.length;d++)c=256*c+b[d];b=c;c=ya(a);a:{for(d=0;d<xa.length;d++)if(ua(c,xa[d])){d=!0;break a}d=!1}if(d)c=a.b.byteLength-a.a.a;else{if(8==c.length&&c[1]&224)throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var d=c[0]&(1<<8-c.length)-1,e=1;e<c.length;e++)d=256*d+c[e];c=d}c=a.a.a+c<=a.b.byteLength?c:a.b.byteLength-a.a.a;d=new DataView(a.b.buffer,
a.b.byteOffset+a.a.a,c);za(a.a,c);return new Aa(b,d)}function ya(a){var b=Ba(a.a),c;for(c=1;8>=c&&!(b&1<<8-c);c++);if(8<c)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var d=new Uint8Array(c);d[0]=b;for(b=1;b<c;b++)d[b]=Ba(a.a);return d}function Aa(a,b){this.id=a;this.a=b}
function Ca(a){if(8<a.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==a.a.byteLength&&a.a.getUint8(0)&224)throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var b=0,c=0;c<a.a.byteLength;c++)var d=a.a.getUint8(c),b=256*b+d;return b};function w(){this.a={}}w.prototype.push=function(a,b){this.a.hasOwnProperty(a)?this.a[a].push(b):this.a[a]=[b]};w.prototype.set=function(a,b){this.a[a]=b};w.prototype.get=function(a){return(a=this.a[a])?a.slice():null};function Da(a){var b=[],c;for(c in a.a)b.push.apply(b,a.a[c]);return b}function Fa(a,b,c){if(a=a.a[b])for(b=0;b<a.length;++b)a[b]==c&&(a.splice(b,1),--b)}function Ga(a){var b=[],c;for(c in a.a)b.push(c);return b};function Ha(){return Date.now()+Ia}var Ia=0;function Ja(){};function Ka(){this.h=this.a="";this.i=!1;this.s=this.l=null;this.v=this.g=!1;this.j=this.f="";this.c=null;this.b=[]}
function La(a){var b=new Ka;if(!a)return b;var c=ka(a,"keySystem");if(null!=c)b.a=c;else throw Error("'keySystem' cannot be null.");var d=ka(a,"licenseServerUrl");if(null!=d)b.h=d;else if(c)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");c=ha(a,"withCredentials");null!=c&&(b.i=c);c=la(a,"licensePostProcessor",Function);null!=c&&(b.l=c);c=la(a,"licensePreProcessor",Function);null!=c&&(b.s=c);c=ha(a,"distinctiveIdentifierRequired");null!=c&&(b.g=c);c=ha(a,
"persistentStateRequired");null!=c&&(b.v=c);c=ka(a,"audioRobustness");null!=c&&(b.f=c);c=ka(a,"videoRobustness");null!=c&&(b.j=c);c=la(a,"serverCertificate",Uint8Array);null!=c&&(b.c=c);if(c=la(a,"initData",Object)){a=la(c,"initData",Uint8Array);if(null==a)throw Error("'initData.initData' cannot be null.");c=ka(c,"initDataType");if(null==c)throw Error("'initData.initDataType' cannot be null.");b.b.push({initData:new Uint8Array(a.buffer),initDataType:c})}return b}
function Ma(a,b){var c=new Ka;c.a=a.a;c.h=a.h;c.i=a.i;c.l=a.l;c.s=a.s;c.g=a.g;c.v=a.v;c.f=a.f;c.j=a.j;c.c=a.c?new Uint8Array(a.c.buffer):null;Na(c,a.b);Na(c,b.b);return c}function Na(a,b){var c=a.b.concat(b.map(function(a){return{initData:new Uint8Array(a.initData.buffer),initDataType:a.initDataType}}));a.b=na(c,Oa)}function Oa(a,b){return a.initDataType==b.initDataType&&ua(a.initData,b.initData)};function Pa(a){this.c=Math.exp(Math.log(.5)/a);this.a=this.b=0}Pa.prototype.sample=function(a,b){var c=Math.pow(this.c,a);this.b=b*(1-c)+c*this.b;this.a+=a};function Qa(a){return a.b/(1-Math.pow(a.c,a.a))};function x(a){var b=new CustomEvent(a.type,{detail:a.detail,bubbles:!!a.bubbles}),c;for(c in a)c in b||(b[c]=a[c]);return b}function y(a){return new CustomEvent("error",{detail:a,bubbles:!0})};function Ra(a,b,c){Sa(b);Sa(c);return c==b||a>=Ta&&c==b.split("-")[0]||a>=Ua&&c.split("-")[0]==b.split("-")[0]?!0:!1}var Ta=1,Ua=2;function Sa(a){a=a.toLowerCase().split("-");var b=Va[a[0]];b&&(a[0]=b);return a.join("-")}
var Va={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",
fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",
lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",
srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};function z(a){this.ya=new w;this.v=a}p("shaka.util.FakeEventTarget",z);z.prototype.addEventListener=function(a,b,c){c||this.ya.push(a,b)};z.prototype.removeEventListener=function(a,b,c){c||Fa(this.ya,a,b)};
z.prototype.dispatchEvent=function(a){a.hasOwnProperty("srcElement")||(delete a.srcElement,Object.defineProperty(a,"srcElement",{get:function(){return null}}));if(a.hasOwnProperty("target"))a.target=this;else{delete a.target;var b=this;Object.defineProperty(a,"target",{get:function(){return b},set:function(a){b=a}})}if(a.hasOwnProperty("currentTarget"))a.currentTarget=null;else{delete a.currentTarget;var c=null;Object.defineProperty(a,"currentTarget",{get:function(){return c},set:function(a){c=a}})}return Wa(this,
a)};function Wa(a,b){b.currentTarget=a;for(var c=a.ya.get(b.type)||[],d=0;d<c.length;++d){var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(a,b)}catch(f){}}a.v&&b.bubbles&&Wa(a.v,b);return b.defaultPrevented};function Xa(){z.call(this,null);this.a=new Pa(3);this.c=new Pa(10);this.b=0}q(Xa,z);p("shaka.util.EWMABandwidthEstimator",Xa);Xa.prototype.sample=function(a,b){if(!(65536>b)){a=Math.max(a,50);var c=8E3*b/a,d=a/1E3;this.a.sample(d,c);this.c.sample(d,c);this.dispatchEvent(x({type:"bandwidth"}));this.b=Date.now()}};Xa.prototype.getBandwidth=function(){return.5>this.a.a?5E5:Math.min(Qa(this.a),Qa(this.c))};Xa.prototype.getDataAge=function(){return(Date.now()-this.b)/1E3};
Xa.prototype.supportsCaching=function(){return!1};function wa(a){var b=Ya;this.b=a;this.c=b==Za;this.a=0}var Ya=0,Za=1;function $a(a){return a.a<a.b.byteLength}function Ba(a){var b=a.b.getUint8(a.a);a.a+=1;return b}function B(a){var b=a.b.getUint32(a.a,a.c);a.a+=4;return b}function ab(a){var b,c;a.c?(b=a.b.getUint32(a.a,!0),c=a.b.getUint32(a.a+4,!0)):(c=a.b.getUint32(a.a,!1),b=a.b.getUint32(a.a+4,!1));if(2097151<c)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");a.a+=8;return c*Math.pow(2,32)+b}
function bb(a){if(a.a+16>a.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var b=new Uint8Array(a.b.buffer,a.a,16);a.a+=16;return b}function za(a,b){if(a.a+b>a.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");a.a+=b};function cb(){this.g=new r;this.f=!1;this.a=null;this.b=[];this.c=null}function db(a,b){if(a.f)throw Error("Cannot append to a running task!");a.b.push(b)}cb.prototype.start=function(){if(this.f)throw Error("Task already started!");this.f=!0;this.b.unshift(function(){});eb(this,void 0)};cb.prototype.end=function(){this.b.splice(1)};
function eb(a,b){var c=a.b[0](b),d;c?(d=c[0],a.c=c[1]):(d=Promise.resolve(),a.c=null);d.then(u(a,function(a){this.a?(this.b=[],this.c=null,fb(this)):(this.b.shift(),this.b.length?eb(this,a):(this.g.resolve(a),this.c=null))})).catch(u(a,function(a){this.b=[];this.c=null;this.a?fb(this):this.g.reject(a)}))}function fb(a){var b=Error("Task aborted.");b.type="aborted";a.g.reject(b);window.setTimeout(function(){this.a.resolve();this.a=null}.bind(a),5)};function C(){this.a=new w}C.prototype.destroy=function(){gb(this);this.a=null};function D(a,b,c,d){b=new hb(b,c,d);a.a.push(c,b)}C.prototype.sa=function(a,b){for(var c=this.a.get(b)||[],d=0;d<c.length;++d){var e=c[d];e.target==a&&(e.sa(),Fa(this.a,b,e))}};function gb(a){for(var b=Da(a.a),c=0;c<b.length;++c)b[c].sa();a.a.a={}}function hb(a,b,c){this.target=a;this.type=b;this.a=c;this.target.addEventListener(b,c,!1)}
hb.prototype.sa=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)};function ib(a,b){z.call(this,b);this.a=null;this.h=a}q(ib,z);
function jb(a){if(!window.indexedDB)return a=Error("Persistant storage requires IndexedDB support."),a.type="storage",Promise.reject(a);if(a.a)return a=Error("A database connection is already open."),a.type="storage",Promise.reject(a);var b=new r,c=window.indexedDB.open("content_database",1);c.onupgradeneeded=u(a,function(a){this.a=a.target.result;kb(this,"group_store",{keyPath:"group_id"});kb(this,"stream_index_store",{keyPath:"stream_id"});a=kb(this,"content_store",{autoIncrement:"true"});a.createIndex("segment",
["stream_id","segment_id"],{unique:!0});a.createIndex("stream","stream_id",{unique:!1})});c.onsuccess=u(a,function(a){this.a=a.target.result;b.resolve()});c.onerror=function(){b.reject(c.error)};return b}function lb(a){a.a&&(a.a.close(),a.a=null)}function kb(a,b,c){a.a.objectStoreNames.contains(b)&&a.a.deleteObjectStore(b);return a.a.createObjectStore(b,c)}function mb(a){return nb(a,"content_store")}function ob(a){return nb(a,"stream_index_store")}function pb(a){return nb(a,"group_store")}
function nb(a,b){return a.a.transaction([b],a.h).objectStore(b)}function qb(a,b){var c=new r,d=a.get(b);d.onerror=function(){c.reject(d.error)};d.onsuccess=function(){if(d.result)c.resolve(d.result);else{var a=Error("Item not found.");a.type="storage";c.reject(a)}};return c};function rb(){ib.call(this,"readonly",null)}q(rb,ib);function sb(a){var b=new r,c=[],d=pb(a).openCursor();d.onerror=function(){b.reject(d.error)};d.onsuccess=function(a){(a=a.target.result)?(c.push(a.key),a.continue()):b.resolve(c)};return b}
function tb(a,b){return qb(pb(a),b).then(u(a,function(a){a.session_ids=na(a.session_ids);return a.hasOwnProperty("duration")||a.hasOwnProperty("key_system")?Promise.resolve(a):ub(this,a.stream_ids[0]).then(function(b){a.duration=b.duration;a.key_system=b.key_system;a.license_server=b.license_server;a.with_credentials=b.with_credentials;a.distinctive_identifier=b.distinctive_identifier;a.audio_robustness=b.audio_robustness;a.video_robustness=b.video_robustness;return Promise.resolve(a)})}))}
function ub(a,b){return qb(ob(a),b)}function vb(a,b,c){return qb(mb(a).index("segment"),[b,c]).then(function(a){return Promise.resolve(a.content)})};function wb(a,b,c){MediaSource.isTypeSupported(b);b=a.addSourceBuffer(b);this.i=a;this.c=b;this.l=c;this.j=new C;this.g=null;this.b=[];this.w=0;this.f=this.a=null;this.s=0;D(this.j,this.c,"updateend",this.B.bind(this))}var xb=1/60;wb.prototype.destroy=function(){yb(this).catch(function(){});this.f&&this.f.destroy();this.a=this.f=null;this.g&&(lb(this.g),this.g=null);this.b=null;this.j.destroy();this.i=this.c=this.j=null};
function zb(a,b){for(var c=a.c.buffered,d=0;d<c.length;++d){var e=c.start(d)-xb,f=c.end(d)+xb;if(b>=e&&b<=f)return c.end(d)-b}return 0}
function Ab(a,b,c,d){if(a.a)return a=Error("Cannot fetch ("+a.v+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new cb;c!=a.c.timestampOffset&&(a.c.timestampOffset=c);"idb"!=b.url.b[0].P||a.g||(a.g=new rb,db(a.a,function(){return[jb(this.g)]}.bind(a)));d&&db(a.a,function(){return[Bb(this,d),this.h.bind(this)]}.bind(a));db(a.a,function(){var a=b.a?b.a-b.b:1,c=new Cb;c.a=3;c.h=1E3*a;c.c=1E3*this.s;c.i=this.g;return[Db(b.url,c,this.l),E.prototype.g.bind(b.url)]}.bind(a));
db(a.a,u(a,function(a){this.l.getBandwidth();return[Bb(this,a),this.h.bind(this)]}));var e=0==a.c.buffered.length&&0==a.b.length,f=null;db(a.a,function(){if(0==this.c.buffered.length){var a=Error("Failed to buffer segment ("+this.v+").");a.type="stream";return[Promise.reject(a)]}e&&(a=b.b,f=this.c.buffered.start(0)-a);a=Eb(this.b,b.b);0<=a?this.b.splice(a+1,0,b):this.b.push(b)}.bind(a));return Fb(a).then(function(){return Promise.resolve(f)}.bind(a))}
function Gb(a){if(a.a)return a=Error("Cannot clear ("+a.v+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new cb;db(a.a,function(){var a;a:if(0==this.c.buffered.length)a=Promise.resolve();else{try{this.c.remove(0,this.i.duration)}catch(c){a=Promise.reject(c);break a}this.b=[];a=this.f=new r}return[a,this.h.bind(this)]}.bind(a));return Fb(a)}
function Hb(a,b){if(a.a){var c=Error("Cannot clearAfter ("+a.v+"): previous operation not complete.");c.type="stream";return Promise.reject(c)}a.a=new cb;db(a.a,function(){return[Jb(this,b),this.h.bind(this)]}.bind(a));return Fb(a)}function yb(a){a.a?(a=a.a,a.a?a=a.a:a.f?(a.c&&a.c(),a.a=new r,a=a.a):(a.f=!0,a=Promise.resolve())):a=Promise.resolve();return a}function Fb(a){a.a.start();return a.a.g.then(u(a,function(){this.a=null})).catch(u(a,function(a){this.a=null;return Promise.reject(a)}))}
function Bb(a,b){try{a.c.appendBuffer(b)}catch(c){return Promise.reject(c)}a.f=new r;return a.f}function Jb(a,b){if(0==a.c.buffered.length)return Promise.resolve();var c=Eb(a.b,b);if(-1==c||c==a.b.length-1)return Promise.resolve();try{a.c.remove(a.b[c+1].b,a.i.duration)}catch(d){return Promise.reject(d)}a.b=a.b.slice(0,c+1);a.f=new r;return a.f}wb.prototype.h=function(){this.f&&"open"==this.i.readyState&&this.c.abort()};wb.prototype.B=function(){this.f&&(this.f.resolve(),this.f=null)};function Kb(a){var b=console[a];b?b.bind||(console[a]=function(){b.apply(console,arguments)}):console[a]=function(){}}Kb("error");Kb("warn");Kb("info");Kb("log");Kb("debug");function F(){this.fontSize="100%";this.fontColor=Lb;this.fontOpacity=Mb;this.backgroundColor=Nb;this.backgroundOpacity=Mb;this.fontEdge=Ob}p("shaka.player.TextStyle",F);F.prototype.a=function(){var a=window.localStorage.getItem("ShakaPlayerTextStyle");if(a){var b;try{b=JSON.parse(a)}catch(c){return}if(b&&"object"==typeof b){var a=b,d;for(d in a)d in this&&(this[d]=a[d])}}};F.prototype.load=F.prototype.a;F.prototype.b=function(){window.localStorage.setItem("ShakaPlayerTextStyle",JSON.stringify(this))};
F.prototype.store=F.prototype.b;function Pb(a){var b=[];b.push("font-size: "+a.fontSize);b.push("color: "+Qb(a.fontColor,a.fontOpacity));b.push("background-color: "+Qb(a.backgroundColor,a.backgroundOpacity));for(var c=[],d=0;d<a.fontEdge.length;++d){var e=a.fontEdge[d].slice(3,6);c.push(Qb(a.fontEdge[d].slice(0,3),a.fontOpacity)+" "+e.join("px ")+"px")}b.push("text-shadow: "+c.join(","));return b.join("; ")}function Qb(a,b){return"rgba("+a.concat(b).join(",")+")"}var Lb=[255,255,255],Nb=[0,0,0];
F.StandardColors={WHITE:Lb,BLACK:Nb,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var Mb=1;F.StandardOpacities={OPAQUE:Mb,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var Ob=[];
F.EdgeStyles={NONE:Ob,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};function Rb(a){this.systemIds=[];this.cencKeyIds=[];this.a=[];a=new wa(new DataView(a.buffer));try{for(;$a(a);){var b=a.a,c=B(a),d=B(a);1==c?c=ab(a):0==c&&(c=a.b.byteLength-b);if(1886614376!=d)za(a,c-(a.a-b));else{var e=Ba(a);if(1<e)za(a,c-(a.a-b));else{za(a,3);var f=ta(bb(a)),g=[];if(0<e)for(var h=B(a),l=0;l<h;++l){var m=ta(bb(a));g.push(m)}var n=B(a);za(a,n);this.cencKeyIds.push.apply(this.cencKeyIds,g);this.systemIds.push(f);this.a.push({start:b,end:a.a-1});a.a!=b+c&&za(a,c-(a.a-b))}}}}catch(t){}}
;function Sb(a){Tb[a]={na:Ub(),end:NaN}}function Vb(a){if(a=Tb[a])a.end=Ub()}function Wb(a){return(a=Tb[a])&&a.end?a.end-a.na:NaN}var Ub=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now,Tb={};function G(a){this.c=[];this.b=[];this.ba=Xb;if(a)try{a(this.W.bind(this),this.a.bind(this))}catch(b){this.a(b)}}var Xb=0;function Yb(){window.Promise||(window.Promise=G,window.Promise.resolve=Zb,window.Promise.reject=$b,window.Promise.all=ac,window.Promise.race=bc,window.setImmediate?(cc=function(a){return window.setImmediate(a)},dc=function(a){return window.clearImmediate(a)}):(cc=function(a){return window.setTimeout(a,0)},dc=function(a){return window.clearTimeout(a)}))}
p("shaka.polyfill.Promise.install",Yb);function Zb(a){var b=new G;b.W(a);return b}function $b(a){var b=new G;b.a(a);return b}function ac(a){function b(a,b,c){a.ba==Xb&&(e[b]=c,d++,d==e.length&&a.W(e))}var c=new G;if(!a.length)return c.W([]),c;for(var d=0,e=Array(a.length),f=c.a.bind(c),g=0;g<a.length;++g)a[g]&&a[g].then?a[g].then(b.bind(null,c,g),f):b(c,g,a[g]);return c}function bc(a){for(var b=new G,c=b.W.bind(b),d=b.a.bind(b),e=0;e<a.length;++e)a[e]&&a[e].then?a[e].then(c,d):c(a[e]);return b}
G.prototype.then=function(a,b){var c=new G;switch(this.ba){case 1:ec(this,c,a);break;case 2:ec(this,c,b);break;case Xb:this.c.push({Ia:c,Ba:a}),this.b.push({Ia:c,Ba:b})}return c};G.prototype.then=G.prototype.then;G.prototype.catch=function(a){return this.then(void 0,a)};G.prototype["catch"]=G.prototype.catch;G.prototype.W=function(a){if(this.ba==Xb){this.wa=a;this.ba=1;for(a=0;a<this.c.length;++a)ec(this,this.c[a].Ia,this.c[a].Ba);this.c=[];this.b=[]}};
G.prototype.a=function(a){if(this.ba==Xb){this.wa=a;this.ba=2;for(a=0;a<this.b.length;++a)ec(this,this.b[a].Ia,this.b[a].Ba);this.c=[];this.b=[]}};function ec(a,b,c){fc.push(function(){if(c&&"function"==typeof c){try{var a=c(this.wa)}catch(e){b.a(e);return}a instanceof G?a==b?b.a(new TypeError("Chaining cycle detected")):a.then(b.W.bind(b),b.a.bind(b)):b.W(a)}else 1==this.ba?b.W(this.wa):b.a(this.wa)}.bind(a));null==gc&&(gc=cc(hc))}
function hc(){for(;fc.length;){null!=gc&&(dc(gc),gc=null);var a=fc;fc=[];for(var b=0;b<a.length;++b)a[b]()}}function cc(){return 0}function dc(){}var gc=null,fc=[];function ic(a,b){try{var c=new jc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}
function jc(a,b){this.keySystem=a;for(var c=!1,d=0;d<b.length;++d){var e=b[d],f={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:e.initDataTypes,sessionTypes:["temporary"]},g=!1;if(e.audioCapabilities)for(var h=0;h<e.audioCapabilities.length;++h){var l=e.audioCapabilities[h];if(l.contentType){var g=!0,m=l.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,m)&&(f.audioCapabilities.push(l),c=!0)}}if(e.videoCapabilities)for(h=
0;h<e.videoCapabilities.length;++h)l=e.videoCapabilities[h],l.contentType&&(g=!0,m=l.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,m)&&(f.videoCapabilities.push(l),c=!0));g||(c=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4"));"required"==e.persistentState&&(f.persistentState="required",f.sessionTypes=["persistent-license"]);if(c){this.a=f;return}}c=Error("Unsupported keySystem");c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;throw c;}
jc.prototype.createMediaKeys=function(){var a=new kc(this.keySystem);return Promise.resolve(a)};jc.prototype.getConfiguration=function(){return this.a};function lc(a){var b=this.mediaKeys;b&&b!=a&&mc(b,null);delete this.mediaKeys;return(this.mediaKeys=a)?mc(a,this):Promise.resolve()}function kc(a){this.a=new MSMediaKeys(a);this.b=new C}kc.prototype.createSession=function(a){if("temporary"!=(a||"temporary"))throw new TypeError("Session type "+a+" is unsupported on this platform.");return new nc(this.a)};
kc.prototype.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))};function mc(a,b){function c(){b.msSetMediaKeys(d.a);b.removeEventListener("loadedmetadata",c)}gb(a.b);if(!b)return Promise.resolve();D(a.b,b,"msneedkey",oc);var d=a;try{return 1<=b.readyState?b.msSetMediaKeys(a.a):b.addEventListener("loadedmetadata",c),Promise.resolve()}catch(e){return Promise.reject(e)}}
function nc(a){z.call(this,null);this.c=null;this.g=a;this.b=this.a=null;this.f=new C;this.sessionId="";this.expiration=NaN;this.closed=new r;this.keyStatuses=new pc}q(nc,z);k=nc.prototype;k.generateRequest=function(a,b){this.a=new r;try{this.c=this.g.createSession("video/mp4",new Uint8Array(b),null),D(this.f,this.c,"mskeymessage",this.Bb.bind(this)),D(this.f,this.c,"mskeyadded",this.zb.bind(this)),D(this.f,this.c,"mskeyerror",this.Ab.bind(this)),qc(this,"status-pending")}catch(c){this.a.reject(c)}return this.a};
k.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))};k.update=function(a){this.b=new r;try{this.c.update(new Uint8Array(a))}catch(b){this.b.reject(b)}return this.b};k.close=function(){try{this.c.close(),this.closed.resolve(),gb(this.f)}catch(a){this.closed.reject(a)}return this.closed};k.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))};
function oc(a){var b=a.initData;if(b){var c=new Rb(b);if(1>=c.a.length)a=b;else{var d=[];for(a=0;a<c.a.length;a++)d.push(b.subarray(c.a[a].start,c.a[a].end+1));b=na(d,rc);for(a=c=0;a<b.length;a++)c+=b[a].length;c=new Uint8Array(c);for(a=d=0;a<b.length;a++)c.set(b[a],d),d+=b[a].length;a=c}}else a=b;a=x({type:"encrypted",initDataType:"cenc",initData:a});this.dispatchEvent(a)}function rc(a,b){return ua(a,b)}
k.Bb=function(a){this.a&&(this.a.resolve(),this.a=null);a=x({type:"message",messageType:void 0==this.keyStatuses.Fa()?"licenserequest":"licenserenewal",message:a.message.buffer});this.dispatchEvent(a)};k.zb=function(){this.a?(this.a.resolve(),this.a=null):this.b&&(qc(this,"usable"),this.b.resolve(),this.b=null)};
k.Ab=function(){var a=Error("EME v20140218 key error");a.errorCode=this.c.error;if(null!=this.a)this.a.reject(a),this.a=null;else if(null!=this.b)this.b.reject(a),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:qc(this,"output-not-allowed");default:qc(this,"internal-error")}};function qc(a,b){a.keyStatuses.Ma(b);var c=x({type:"keystatuseschange"});a.dispatchEvent(c)}function pc(){this.size=0;this.a=void 0}var sc;
k=pc.prototype;k.Ma=function(a){this.size=void 0==a?0:1;this.a=a};k.Fa=function(){return this.a};k.forEach=function(a){this.a&&a(sc,this.a)};k.get=function(a){if(this.has(a))return this.a};k.has=function(a){var b=sc;return this.a&&ua(new Uint8Array(a),new Uint8Array(b))?!0:!1};function tc(){var a="CustomEvent"in window;if(a)try{new CustomEvent("")}catch(b){a=!1}a||(window.CustomEvent=vc)}p("shaka.polyfill.CustomEvent.install",tc);function vc(a,b){var c=document.createEvent("CustomEvent"),d=b||{bubbles:!1,cancelable:!1,detail:null};c.initCustomEvent(a,!!d.bubbles,!!d.cancelable,d.detail);return c};function wc(){var a=HTMLVideoElement.prototype;!a.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in a&&(a.getVideoPlaybackQuality=xc)}p("shaka.polyfill.VideoPlaybackQuality.install",wc);function xc(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}};function yc(){var a=Element.prototype;a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||a.webkitRequestFullscreen;a=Document.prototype;a.exitFullscreen=a.exitFullscreen||a.mozCancelFullScreen||a.msExitFullscreen||a.webkitExitFullscreen;"fullscreenElement"in document||Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}});document.addEventListener("webkitfullscreenchange",
zc);document.addEventListener("webkitfullscreenerror",zc);document.addEventListener("mozfullscreenchange",zc);document.addEventListener("mozfullscreenerror",zc);document.addEventListener("MSFullscreenChange",zc);document.addEventListener("MSFullscreenError",zc)}p("shaka.polyfill.Fullscreen.install",yc);function zc(a){var b=a.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),b=new Event(b,a);a.target.dispatchEvent(b)};function Ac(){return Promise.reject(Error("The key system specified is not supported."))}function Bc(a){return null==a?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function Cc(){throw new TypeError("Illegal constructor.");}Cc.prototype.createSession=function(){};Cc.prototype.setServerCertificate=function(){};function Dc(){throw new TypeError("Illegal constructor.");}Dc.prototype.getConfiguration=function(){};Dc.prototype.createMediaKeys=function(){};function Ec(a,b){try{var c=new Fc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}function Gc(a){var b=this.mediaKeys;b&&b!=a&&Hc(b,null);delete this.mediaKeys;(this.mediaKeys=a)&&Hc(a,this);return Promise.resolve()}
function Fc(a,b){this.a=this.keySystem=a;var c=!0;"org.w3.clearkey"==a&&(this.a="webkit-org.w3.clearkey",c=!1);var d=!1,e;e=document.getElementsByTagName("video");e=e.length?e[0]:document.createElement("video");for(var f=0;f<b.length;++f){var g=b[f],h={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:g.initDataTypes,sessionTypes:["temporary"]},l=!1;if(g.audioCapabilities)for(var m=0;m<g.audioCapabilities.length;++m){var n=g.audioCapabilities[m];
n.contentType&&(l=!0,e.canPlayType(n.contentType.split(";")[0],this.a)&&(h.audioCapabilities.push(n),d=!0))}if(g.videoCapabilities)for(m=0;m<g.videoCapabilities.length;++m)n=g.videoCapabilities[m],n.contentType&&(l=!0,e.canPlayType(n.contentType,this.a)&&(h.videoCapabilities.push(n),d=!0));l||(d=e.canPlayType("video/mp4",this.a)||e.canPlayType("video/webm",this.a));"required"==g.persistentState&&(c?(h.persistentState="required",h.sessionTypes=["persistent-license"]):d=!1);if(d){this.b=h;return}}c=
"Unsupported keySystem";if("org.w3.clearkey"==a||"com.widevine.alpha"==a)c="None of the requested configurations were supported.";c=Error(c);c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;throw c;}Fc.prototype.createMediaKeys=function(){var a=new Ic(this.a);return Promise.resolve(a)};Fc.prototype.getConfiguration=function(){return this.b};function Ic(a){this.g=a;this.b=null;this.a=new C;this.c=[];this.f={}}
function Hc(a,b){a.b=b;gb(a.a);b&&(D(a.a,b,"webkitneedkey",a.Ob.bind(a)),D(a.a,b,"webkitkeymessage",a.Nb.bind(a)),D(a.a,b,"webkitkeyadded",a.Lb.bind(a)),D(a.a,b,"webkitkeyerror",a.Mb.bind(a)))}k=Ic.prototype;k.createSession=function(a){var b=a||"temporary";if("temporary"!=b&&"persistent-license"!=b)throw new TypeError("Session type "+a+" is unsupported on this platform.");a=this.b||document.createElement("video");a.src||(a.src="about:blank");b=new Jc(a,this.g,b);this.c.push(b);return b};
k.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))};k.Ob=function(a){a=x({type:"encrypted",initDataType:"webm",initData:a.initData});this.b.dispatchEvent(a)};k.Nb=function(a){var b=Kc(this,a.sessionId);b&&(a=x({type:"message",messageType:void 0==b.keyStatuses.Fa()?"licenserequest":"licenserenewal",message:a.message}),b.b&&(b.b.resolve(),b.b=null),b.dispatchEvent(a))};
k.Lb=function(a){if(a=Kc(this,a.sessionId))Lc(a,"usable"),a.a&&a.a.resolve(),a.a=null};
k.Mb=function(a){var b=Kc(this,a.sessionId);if(b){var c=Error("EME v0.1b key error");c.errorCode=a.errorCode;c.errorCode.systemCode=a.systemCode;!a.sessionId&&b.b?(c.method="generateRequest",45==a.systemCode&&(c.message="Unsupported session type."),b.b.reject(c),b.b=null):a.sessionId&&b.a?(c.method="update",b.a.reject(c),b.a=null):(c=a.systemCode,a.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Lc(b,"output-restricted"):1==c?Lc(b,"expired"):Lc(b,"internal-error"))}};
function Kc(a,b){var c=a.f[b];return c?c:(c=a.c.shift())?(c.sessionId=b,a.f[b]=c):null}function Jc(a,b,c){z.call(this,null);this.f=a;this.h=!1;this.a=this.b=null;this.c=b;this.g=c;this.sessionId="";this.expiration=NaN;this.closed=new r;this.keyStatuses=new Mc}q(Jc,z);
function Nc(a,b,c){if(a.h)return Promise.reject(Error("The session is already initialized."));a.h=!0;var d;try{if("persistent-license"==a.g)if(c)d=ra("LOAD_SESSION|"+c);else{var e=new Uint8Array(b);d=ra("PERSISTENT|"+qa(e))}else d=new Uint8Array(b)}catch(f){return Promise.reject(f)}a.b=new r;try{a.f.webkitGenerateKeyRequest(a.c,d)}catch(g){if("InvalidStateError"!=g.name)return a.b=null,Promise.reject(g);setTimeout(function(){try{this.f.webkitGenerateKeyRequest(this.c,d)}catch(a){this.b.reject(a),
this.b=null}}.bind(a),10)}return a.b}k=Jc.prototype;k.Qa=function(a,b){if(this.a)this.a.then(this.Qa.bind(this,a,b)).catch(this.Qa.bind(this,a,b));else{this.a=a;var c,d;"webkit-org.w3.clearkey"==this.c?(c=qa(new Uint8Array(b)),d=JSON.parse(c),"oct"!=d.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),c=sa(d.keys[0].k),d=sa(d.keys[0].kid)):(c=new Uint8Array(b),d=null);try{this.f.webkitAddKey(this.c,c,d,this.sessionId)}catch(e){this.a.reject(e),this.a=null}}};
function Lc(a,b){a.keyStatuses.Ma(b);var c=x({type:"keystatuseschange"});a.dispatchEvent(c)}k.generateRequest=function(a,b){return Nc(this,b,null)};k.load=function(a){return"persistent-license"==this.g?Nc(this,null,a):Promise.reject(Error("Not a persistent session."))};k.update=function(a){var b=new r;this.Qa(b,a);return b};
k.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;this.f.webkitCancelKeyRequest(this.c,this.sessionId)}this.closed.resolve();return this.closed};k.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()};function Mc(){this.size=0;this.a=void 0}var Oc;k=Mc.prototype;k.Ma=function(a){this.size=void 0==a?0:1;this.a=a};k.Fa=function(){return this.a};
k.forEach=function(a){this.a&&a(Oc,this.a)};k.get=function(a){if(this.has(a))return this.a};k.has=function(a){var b=Oc;return this.a&&ua(new Uint8Array(a),new Uint8Array(b))?!0:!1};function Pc(){Navigator.prototype.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(HTMLMediaElement.prototype.webkitGenerateKeyRequest?(Oc=(new Uint8Array([0])).buffer,Navigator.prototype.requestMediaKeySystemAccess=Ec,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Gc,window.MediaKeys=Ic,window.MediaKeySystemAccess=Fc):window.MSMediaKeys?(sc=(new Uint8Array([0])).buffer,delete HTMLMediaElement.prototype.mediaKeys,
HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=lc,window.MediaKeys=kc,window.MediaKeySystemAccess=jc,Navigator.prototype.requestMediaKeySystemAccess=ic):(Navigator.prototype.requestMediaKeySystemAccess=Ac,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Bc,window.MediaKeys=Cc,window.MediaKeySystemAccess=Dc))}p("shaka.polyfill.MediaKeys.install",Pc);p("shaka.polyfill.installAll",function(){tc();yc();wc();Yb();Pc()});var Qc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function H(a){var b;a instanceof H?(Rc(this,a.P),this.ca=a.ca,this.S=a.S,Sc(this,a.ia),this.O=a.O,Tc(this,a.a.clone()),this.aa=a.aa):a&&(b=String(a).match(Qc))?(Rc(this,b[1]||"",!0),this.ca=Uc(b[2]||""),this.S=Uc(b[3]||"",!0),Sc(this,b[4]),this.O=Uc(b[5]||"",!0),Tc(this,b[6]||"",!0),this.aa=Uc(b[7]||"")):this.a=new Vc(null)}k=H.prototype;k.P="";k.ca="";k.S="";k.ia=null;k.O="";k.aa="";
k.toString=function(){var a=[],b=this.P;b&&a.push(Wc(b,Xc,!0),":");if(b=this.S){a.push("//");var c=this.ca;c&&a.push(Wc(c,Xc,!0),"@");a.push(encodeURIComponent(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));b=this.ia;null!=b&&a.push(":",String(b))}if(b=this.O)this.S&&"/"!=b.charAt(0)&&a.push("/"),a.push(Wc(b,"/"==b.charAt(0)?Yc:Zc,!0));(b=this.a.toString())&&a.push("?",b);(b=this.aa)&&a.push("#",Wc(b,$c));return a.join("")};
k.resolve=function(a){var b=this.clone();"data"===b.P&&(b=new H);var c=!!a.P;c?Rc(b,a.P):c=!!a.ca;c?b.ca=a.ca:c=!!a.S;c?b.S=a.S:c=null!=a.ia;var d=a.O;if(c)Sc(b,a.ia);else if(c=!!a.O){if("/"!=d.charAt(0))if(this.S&&!this.O)d="/"+d;else{var e=b.O.lastIndexOf("/");-1!=e&&(d=b.O.substr(0,e+1)+d)}if(".."==d||"."==d)d="";else if(-1!=d.indexOf("./")||-1!=d.indexOf("/.")){for(var e=0==d.lastIndexOf("/",0),d=d.split("/"),f=[],g=0;g<d.length;){var h=d[g++];"."==h?e&&g==d.length&&f.push(""):".."==h?((1<f.length||
1==f.length&&""!=f[0])&&f.pop(),e&&g==d.length&&f.push("")):(f.push(h),e=!0)}d=f.join("/")}}c?b.O=d:c=""!==a.a.toString();c?Tc(b,a.a.clone()):c=!!a.aa;c&&(b.aa=a.aa);return b};k.clone=function(){return new H(this)};function Rc(a,b,c){a.P=c?Uc(b,!0):b;a.P&&(a.P=a.P.replace(/:$/,""))}function Sc(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.ia=b}else a.ia=null}function Tc(a,b,c){b instanceof Vc?a.a=b:(c||(b=Wc(b,ad)),a.a=new Vc(b))}
function Uc(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""}function Wc(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,bd),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function bd(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Xc=/[#\/\?@]/g,Zc=/[\#\?:]/g,Yc=/[\#\?]/g,ad=/[\#\?@]/g,$c=/#/g;function Vc(a){this.b=a||null}Vc.prototype.a=null;Vc.prototype.c=null;
function cd(a,b,c){if(!a.a&&(a.a={},a.c=0,a.b))for(var d=a.b.split("&"),e=0;e<d.length;e++){var f=d[e].indexOf("="),g=null,h=null;0<=f?(g=d[e].substring(0,f),h=d[e].substring(f+1)):g=d[e];g=decodeURIComponent(g.replace(/\+/g," "));h=h||"";cd(a,g,decodeURIComponent(h.replace(/\+/g," ")))}a.b=null;(d=a.a.hasOwnProperty(b)&&a.a[b])||(a.a[b]=d=[]);d.push(c);a.c++}
Vc.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var a=[],b;for(b in this.a)for(var c=encodeURIComponent(b),d=this.a[b],e=0;e<d.length;e++){var f=c;""!==d[e]&&(f+="="+encodeURIComponent(d[e]));a.push(f)}return this.b=a.join("&")};Vc.prototype.clone=function(){var a=new Vc;a.b=this.b;if(this.a){var b={},c;for(c in this.a)b[c]=this.a[c].concat();a.a=b;a.c=this.c}return a};function dd(a,b){this.url=a;this.b=b||new Cb;this.g=this.i=this.h=0;this.a=null;this.c=new r;this.f=null}function Cb(){this.body=null;this.a=1;this.h=1E3;this.c=0;this.method="GET";this.f="arraybuffer";this.b={};this.g=this.j=!1;this.i=null}var ed=!0;function fd(a){gd(a);a.b.body=null;a.c.destroy();a.c=null;a.f=null}function gd(a){a.a&&(a.a.onload=null,a.a.onreadystatechange=null,a.a.onerror=null,a.a.ontimeout=null);a.a=null}k=dd.prototype;
k.rb=function(){if(this.a)return this.c;if(0==this.url.lastIndexOf("data:",0)){var a=this.url.split(":")[1].split(";").pop().split(","),b=a.pop(),b="base64"==a.pop()?window.atob(b.replace(/-/g,"+").replace(/_/g,"/")):window.decodeURIComponent(b);"arraybuffer"==this.b.f&&(b=ra(b).buffer);a=JSON.parse(JSON.stringify(new XMLHttpRequest));a.response=b;a.responseText=b.toString();b=this.c;b.resolve(a);fd(this);return b}if(0==this.url.lastIndexOf("idb:",0))return hd(this);this.h++;this.i=Date.now();this.g||
(this.g=this.b.h);this.a=new XMLHttpRequest;a=this.url;ed&&(this.f&&!this.f.supportsCaching()||this.b.g)&&(a=new H(a),cd(a.a,"_",Date.now()),a=a.toString());this.a.open(this.b.method,a,!0);this.a.responseType=this.b.f;this.a.timeout=this.b.c;this.a.withCredentials=this.b.j;this.a.onload=this.xb.bind(this);this.b.g&&(this.a.onreadystatechange=this.Eb.bind(this));this.a.onerror=this.Tb.bind(this);this.a.ontimeout=this.Ib.bind(this);for(b in this.b.b)this.a.setRequestHeader(b,this.b.b[b]);this.a.send(this.b.body);
return this.c};function hd(a){var b=a.url.split("/");return vb(a.b.i,parseInt(b[2],10),parseInt(b[3],10)).then(u(a,function(a){var b=JSON.parse(JSON.stringify(new XMLHttpRequest));b.response=a;a=this.c;a.resolve(b);fd(this);return a})).catch(u(a,function(a){fd(this);return Promise.reject(a)}))}function id(a,b,c){b=Error(b);b.type=c;b.status=a.a.status;b.url=a.url;b.method=a.b.method;b.body=a.b.body;b.Xb=a.a;return b}
k.xb=function(a){this.f&&this.f.sample(Date.now()-this.i,a.loaded);200<=this.a.status&&299>=this.a.status?(this.c.resolve(this.a),fd(this)):this.h<this.b.a?jd(this):(a=id(this,"HTTP error.","net"),this.c.reject(a),fd(this))};k.Eb=function(){if(this.a.readyState==XMLHttpRequest.HEADERS_RECEIVED){var a=Date.parse(this.a.getResponseHeader("Date"));a&&(Ia=a-Date.now())}};k.Tb=function(){var a=id(this,"Network failure.","net");this.c.reject(a);fd(this)};
k.Ib=function(){if(this.h<this.b.a)jd(this);else{var a=id(this,"Request timed out.","net");this.c.reject(a);fd(this)}};function jd(a){gd(a);window.setTimeout(a.rb.bind(a),a.g*(1+.5*(2*Math.random()-1)));a.g*=2};function E(a,b,c,d){this.b=b;this.f=c||0;this.i=null!=d?d:null;this.c=this.a=null;this.j=a;this.h=null}function kd(a,b){return a&&0!==a.length?a.map(function(a){return a.resolve(b)}):[b]}function Db(a,b,c){if(a.a)return a.a;b=b||new Cb;if(a.f||a.i)b.b.Range="bytes="+(a.f+"-"+(null!=a.i?a.i:""));a.a=ld(a,0,b,c);return a.a}
E.prototype.g=function(){if(this.c){this.a=null;var a=this.c;if(a.a&&a.a.readyState!=XMLHttpRequest.DONE){a.a.abort();var b=id(a,"Request aborted.","aborted");a.c.reject(b);fd(a)}this.h=this.c=null}};
function ld(a,b,c,d){var e=a.b[b].toString();a.j&&(e=a.j(e,c.b)||e);a.c=new dd(e,c);d&&(a.c.f=d);e=a.c.rb().then(u(a,function(a){this.h=this.c=this.a=null;this.h=a.a?new H(a.a):this.b[b];return Promise.resolve(a.response)}));return e=e.catch(u(a,function(a){if(this.a&&b+1<this.b.length)return this.a=ld(this,b+1,c,d);this.a=this.c=null;return Promise.reject(a)}))}E.prototype.clone=function(){return new E(this.j,this.b.map(function(a){return a.clone()}),this.f,this.i)};E.prototype.toString=function(){return this.b[0].toString()};function md(a,b){this.a=a;this.b=b||null}md.prototype.destroy=function(){this.a&&(this.a.g(),this.a=null);this.b=null};md.prototype.create=function(){return this.a?Db(this.a):Promise.resolve(this.b)};function nd(a,b,c){this.b=a;this.a=b;this.url=c}function od(a,b,c){return new nd(b,c,a.url)}function Eb(a,b){for(var c=a.length-1;0<=c;--c){var d=a[c];if(b>=d.b&&(null==d.a||b<d.a))return c}return-1}function pd(a,b){return a.map(function(a){return od(a,a.b+b,null!=a.a?a.a+b:null)})};function qd(){}
qd.prototype.parse=function(a,b,c,d){var e=null;try{a:{var f=[],g=new wa(a),h=B(g);if(1936286840!=B(g))e=null;else{1==h&&(h=ab(g));var l=Ba(g);za(g,3);za(g,4);var m=B(g);if(0==m)e=null;else{var n,t;0==l?(n=B(g),t=B(g)):(n=ab(g),t=ab(g));za(g,2);var A=g.b.getUint16(g.a,g.c);g.a+=2;a=n;b=b+h+t;for(h=0;h<A;h++){var M=B(g);t=(M&2147483648)>>>31;var l=M&2147483647,I=B(g);B(g);if(1==t){e=null;break a}var pa=new E(d,c,b,b+l-1);f.push(new nd(a/m,(a+I)/m,pa));a+=I;b+=l}e=f}}}}catch(Ib){if(!(Ib instanceof RangeError))throw Ib;
}return e};function rd(){}
rd.prototype.parse=function(a,b,c,d){var e=null;try{var f;var g=new va(b);if(440786851!=v(g).id)f=null;else{var h=v(g);if(408125543!=h.id)f=null;else{var l=h.a.byteOffset,m;var n=new va(h.a);for(b=null;$a(n.a);){var t=v(n);if(357149030==t.id){b=t;break}}if(b){for(var A=new va(b.a),n=1E6;$a(A.a);){var M=v(A);if(2807729==M.id){n=Ca(M);break}}m=n/1E9}else m=null;f=m?{Qb:l,Ub:m}:null}}if(f){var I=v(new va(a));if(475249515!=I.id)e=null;else{var pa=f.Qb,Ib=f.Ub;a=[];var Xd=new va(I.a);for(f=I=-1;$a(Xd.a);){var Yd=
v(Xd);if(187==Yd.id){var Ea;var Zd=new va(Yd.a),$d=v(Zd);if(179!=$d.id)Ea=null;else{var vf=Ca($d),ae=v(Zd);if(183!=ae.id)Ea=null;else{for(var be=new va(ae.a),l=0;$a(be.a);){var ce=v(be);if(241==ce.id){l=Ca(ce);break}}Ea={Wb:vf,Pb:l}}}if(Ea){var de=Ib*Ea.Wb,ee=pa+Ea.Pb;if(0<=I){var uc=new E(d,c,f,ee-1);a.push(new nd(I,de,uc))}I=de;f=ee}}}0<=I&&(uc=new E(d,c,f,null),a.push(new nd(I,null,uc)));e=a}}else e=null}catch(fe){if(!(fe instanceof RangeError))throw fe;}return e};function J(a){this.o=a;this.i=0}J.prototype.destroy=function(){this.o=null};k=J.prototype;k.length=function(){return this.o.length};function K(a){if(0==a.o.length)throw new RangeError("SegmentIndex: There is no first SegmentReference.");return a.o[0]}k.A=function(){if(0==this.o.length)throw new RangeError("SegmentIndex: There is no last SegmentReference.");return this.o[this.o.length-1]};
k.get=function(a){if(0>a||a>=this.o.length)throw new RangeError("SegmentIndex: The specified index is out of range.");return this.o[a]};k.la=function(a){a=Eb(this.o,a);return 0<=a?this.o[a]:null};k.Ha=function(a){sd(this,a);return!0};
function sd(a,b){a.i!=b.i&&(b=new J(pd(b.o,a.i-b.i)));if(0==a.length())a.o=b.o.slice(0);else if(0!=b.length()&&null!=a.A().a&&!(null!=b.A().a&&b.A().a<a.A().a)){if(a.A().a<=K(b).b)var c=od(a.A(),a.A().b,K(b).b),c=a.o.slice(0,-1).concat([c]);else{var d;for(d=0;d<a.o.length&&!(a.o[d].a>=K(b).b);++d);a.o[d].b<K(b).b?(c=od(a.o[d],a.o[d].b,K(b).b),c=a.o.slice(0,d).concat([c])):(K(a).b>K(b).b||K(b),c=a.o.slice(0,d))}a.o=c.concat(b.o)}}
k.ka=function(a){var b=a-this.i;if(0==b)return 0;this.o=pd(this.o,b);this.i=a;return b};k.Ea=function(){return 0<this.length()?{start:K(this).b,end:this.A().a}:{start:0,end:0}};function td(a){this.b=a;this.a=null}td.prototype.destroy=function(){this.a&&(this.a.destroy(),this.a=null)};td.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=new nd(0,null,this.b);this.a=new J([a]);return Promise.resolve(this.a)};function ud(a){this.b=a;this.a=null}ud.prototype.destroy=function(){this.b=null;this.a&&(this.a.destroy(),this.a=null)};ud.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=[],b=0;b<this.b.length;++b){var c=this.b[b];a.push(new nd(c.start_time,c.end_time,new E(null,[new H(c.url)],c.start_byte,null)))}this.b=null;this.a=new J(a);return Promise.resolve(this.a)};function vd(){this.C=wd++;this.id=this.H=this.I=null;this.c=0;this.height=this.width=this.bandwidth=null;this.b=this.a="";this.f=[];this.N=!1;this.J=!0}var wd=0;vd.prototype.destroy=function(){this.I&&(this.I.destroy(),this.I=null);this.H&&(this.H.destroy(),this.H=null)};function xd(a){var b=a.a||"";a.b&&(b+='; codecs="'+a.b+'"');return b}function yd(){this.C=zd++;this.id=null;this.contentType=this.lang="";this.b=!1;this.m=[];this.a=[]}var zd=0;
yd.prototype.destroy=function(){for(var a=0;a<this.m.length;++a)this.m[a].destroy();this.a=this.m=null};function Ad(a){for(var b=[],c=0;c<a.a.length;++c){var d=new Bd;d.id=a.C;d.a=a.a[c];d.contentType=a.contentType;d.b=a.m.length?xd(a.m[0]):"";b.push(d)}return b}function Cd(){this.id=null;this.start=0;this.b=null;this.a=[]}Cd.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function Dd(){this.b=!1;this.h=this.g=this.f=null;this.c=0;this.a=[]}
Dd.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function Bd(){this.id=0;this.a=null;this.b=this.contentType=""};function Ed(a,b){z.call(this,a);this.b=b;this.g=!0;this.h=this.f=null;this.c=new r;this.a=null}q(Ed,z);Ed.prototype.F=function(){};Ed.prototype.destroy=function(){this.a&&this.b.removeChild(this.a);this.c.destroy();this.v=this.b=this.f=this.h=this.a=this.c=null};k=Ed.prototype;k.oa=function(){return this.f};k.bb=function(){return this.h};k.sb=function(){return this.c};k.Ga=function(){return!0};
k.ra=function(a){a.I.create().then(u(this,function(b){if(this.b){if(0==b.length())return Promise.reject(Error("No subtitles URL available."));var c=this.f;this.f=a;this.h=b;b=K(b).url.b[0].toString();var d=this.Da();this.a&&(this.va(!1),this.b.removeChild(this.a));this.a=document.createElement("track");this.b.appendChild(this.a);this.a.src=b;this.va(d);b=x({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:a.bandwidth});this.dispatchEvent(b);c||this.c.resolve(0)}}))};k.jb=function(){};
k.kb=function(){return!0};k.va=function(a){this.g=a;this.a&&(this.a.track.mode=a?"showing":"disabled")};k.Da=function(){this.a&&(this.g="showing"==this.a.track.mode);return this.g};function Fd(a,b,c,d,e){z.call(this,a);this.c=b;this.a=new wb(c,d,e);this.w=this.G=this.b=null;this.K=!1;this.g=null;this.l=!1;this.i=null;this.s=!1;this.h=new r;this.j=this.f=!1;this.B=0;this.L=15;this.D=!1}q(Fd,z);Fd.prototype.F=function(a){null!=a.initialStreamBufferSize&&(this.B=Number(a.initialStreamBufferSize));null!=a.streamBufferSize&&(this.L=Number(a.streamBufferSize));null!=a.segmentRequestTimeout&&(this.a.s=Number(a.segmentRequestTimeout))};
Fd.prototype.destroy=function(){Gd(this);this.h.destroy();this.b=this.h=null;this.a.destroy();this.v=this.c=this.a=null};k=Fd.prototype;k.oa=function(){return this.b};k.bb=function(){return this.G};k.sb=function(a){this.f||a.then(function(){this.f=!0;this.g||Hd(this,0)}.bind(this)).catch(function(){});return this.h};k.Ga=function(){return this.j};
k.ra=function(a,b,c){if(a!=this.b){var d=[a.I.create(),a.H.create()];Promise.all(d).then(u(this,function(d){if(this.c){var f=this.b;this.b=a;this.G=d[0];this.w=d[1];this.K=!0;this.l||(f?b&&Id(this,!0,c):Hd(this,0))}})).catch(u(this,function(a){"aborted"!=a.type&&(this.f?(a=y(a),this.dispatchEvent(a)):this.h.reject(a))}))}};k.jb=function(){return Id(this,!1)};
function Id(a,b,c){a.b&&!a.l&&(a.l=!0,Gd(a),yb(a.a).then(u(a,function(){var a=this.c.currentTime;if(!b&&0<zb(this.a,a)&&0<=Eb(this.a.b,a))return Promise.resolve();if(c)return Hb(this.a,this.c.currentTime+c);this.D=!0;return Gb(this.a)})).then(u(a,function(){this.l=!1;Hd(this,0)})).catch(u(a,function(a){this.l=!1;this.f?(a=y(a),this.dispatchEvent(a)):this.h.reject(a)})))}k.kb=function(a){return 0<zb(this.a,a)&&0<=Eb(this.a.b,a)};k.va=function(){};k.Da=function(){return!0};
k.Kb=function(){if(this.s&&!this.f)this.g=null;else{var a;if(a=this.f&&!this.j)a=1<this.a.c.buffered.length?!0:!1;if(a)Id(this,!0);else{this.g=null;a=this.b;var b=this.G,c=this.c.currentTime;zb(this.a,this.s?c:c+(this.i||0))>=(this.s?Math.max(this.B,this.L):this.B)?(Jd(this),Hd(this,1E3/(Math.abs(this.c.playbackRate)||1))):(b=Kd(this,c,b))?(b=Ab(this.a,b,a.c,this.w),this.w=null,this.K&&(this.K=!1,Ld(this,a)),this.j=!1,b.then(u(this,function(a){null==this.i&&(this.i=a);this.D&&0<zb(this.a,c)&&(this.D=
!1,this.c.currentTime+=.001);Hd(this,0)})).catch(u(this,function(a){if("aborted"!=a.type){var b=[0,404,410];"net"==a.type&&-1!=b.indexOf(a.Xb.status)&&this.b&&Hd(this,5E3);a=y(a);this.dispatchEvent(a)}}))):(Jd(this),this.f&&!this.j&&(this.j=!0,Md(this)),Hd(this,1E3))}}};function Kd(a,b,c){a=a.a;var d=a.b.length;a=0<d?a.b[d-1]:null;return null!=a?null!=a.a?c.la(a.a):null:c.la(b)||(c.length()?c.A():null)}
function Jd(a){if(!a.s&&null!=a.i){a.s=!0;var b=a.a,c=a.i,d=c-b.w;0!=d&&(b.b=pd(b.b,d),b.w=c);a.h.resolve(a.i)}}function Ld(a,b){var c;c=b.a.split("/")[0];c=x({type:"adaptation",bubbles:!0,contentType:c,size:"video"!=c?null:{width:b.width,height:b.height},bandwidth:b.bandwidth});a.dispatchEvent(c)}function Md(a){var b=x({type:"ended"});a.dispatchEvent(b)}function Hd(a,b){a.g=window.setTimeout(a.Kb.bind(a),b)}function Gd(a){null!=a.g&&(window.clearTimeout(a.g),a.g=null)};function Nd(){this.streamStats=null;this.droppedFrames=this.decodedFrames=NaN;this.bufferingTime=this.playTime=this.estimatedBandwidth=0;this.playbackLatency=NaN;this.bufferingHistory=[];this.bandwidthHistory=[];this.streamHistory=[]}function Od(a,b){var c=new Pd(b);a.streamHistory.push(new Qd(c));if(c.videoHeight||!a.streamStats)a.streamStats=c}function Pd(a){this.videoWidth=a.width;this.videoHeight=a.height;this.videoMimeType=a.a;this.videoBandwidth=a.bandwidth}
function Qd(a){this.timestamp=Ha()/1E3;this.value=a};function Rd(a,b,c,d,e,f){this.b=new E(null,[new H(a)]);this.a=new Cb;this.a.body=b;this.a.method=c;this.a.a=3;this.a.j=d;this.a.c=1E3*(null!=f?f:0);a=e||{};for(var g in a)this.a.b[g]=a[g]}function Sd(a){return Db(a.b,a.a).then(function(a){return Promise.resolve(new Uint8Array(a))})};function L(a,b,c){z.call(this,a);this.h=b;this.b=c;this.a=this.i=null;this.l=new C;this.c=[];this.f=[];this.s=0;this.g=new r;this.j=null;this.w=0}q(L,z);L.prototype.destroy=function(){this.v=null;for(var a=0;a<this.f.length;++a)this.f[a].close().catch(function(){});this.f=[];this.c=this.a=this.i=null;this.g.destroy();this.g=null;this.l.destroy();this.l=null;this.j&&(window.clearTimeout(this.j),this.j=null);this.h=this.b=null};
L.prototype.initialize=function(){for(var a=new w,b=this.b.ab(),c=0;c<b.length;++c){var d=b[c];d.a.a||d.b&&!Td(d.b)||a.push(d.contentType,d)}for(var c={},d=!1,e=0;e<b.length;++e){var f=b[e];if(f.a.a&&!a.a.hasOwnProperty(f.contentType)){var g=f.a.a,h=c[g];h||(h=f.a,h={audioCapabilities:void 0,videoCapabilities:void 0,initDataTypes:void 0,distinctiveIdentifier:h.g?"required":"optional",persistentState:h.v||this.b.ha()?"required":"optional",sessionTypes:[this.b.ha()?"persistent-license":"temporary"]},
c[g]=h);if(f.b&&(g=f.contentType+"Capabilities",g in h)){d=!0;h[g]||(h[g]=[]);var l;"audio"==f.contentType?l=f.a.f:"video"==f.contentType&&(l=f.a.j);h[g].push({contentType:f.b,robustness:l})}}}if(!d)if(b.length)this.a=b[0].a;else throw a=Error("No DrmInfo exists!"),a.type="drm",a;if(0==Object.keys(c).length)return this.b.Ka(a),this.g.resolve(),Promise.resolve();l=new r;c=Ud(this,c,l);c=c.then(this.D.bind(this,b,a));l.reject(null);return c};
function Vd(a,b){null==a.j&&(a.j=window.setTimeout(function(){var a=Error("Timeout waiting for sessions.");a.type="storage";this.g.reject(a)}.bind(a),b));return a.g}function Wd(a){return Promise.all(a.f.map(function(a){return a.remove()}))}
function Ud(a,b,c){for(var d in b)c=c.catch(function(a,b){return navigator.requestMediaKeySystemAccess(a,[b])}.bind(null,d,b[d]));a.b.ha()&&(c=c.catch(function(){throw Error("Either none of the requested key systems are supported or none of the requested key systems support persistent state.");}));return c}
L.prototype.D=function(a,b,c){if(!this.h)return ge();for(var d=c.keySystem,e=c.getConfiguration(),f=["audio","video"],g=0;g<f.length;++g){var h=f[g];if(!b.a.hasOwnProperty(h)){var l=e[h+"Capabilities"];if(l){for(var l=l[0],m=[],n={},t=0;t<a.length;++t){var A=a[t],M=l?A.b==l.contentType:A.contentType==h;A.a.a!=d||!M||A.id in n||(m.push(A),n[A.id]=!0,this.a=this.a?Ma(this.a,A.a):A.a)}b.set(h,m)}}}this.b.Ka(b);return c.createMediaKeys().then(function(a){this.i=a}.bind(this))};
function he(a){return a.h?a.i?a.h.setMediaKeys(a.i).then(u(a,function(){return this.h?this.a.c?this.i.setServerCertificate(this.a.c):Promise.resolve():ge()})).then(u(a,function(){if(!this.h)return ge();if(0<this.b.ua().length)ie(this);else{for(var a=0;a<this.a.b.length;++a){var c=this.a.b[a];this.B({type:"encrypted",initDataType:c.initDataType,initData:c.initData})}0==this.a.b.length&&D(this.l,this.h,"encrypted",this.B.bind(this))}})):Promise.resolve():ge()}
function ge(){var a=Error("EmeManager destroyed");a.type="destroy";return Promise.reject(a)}
L.prototype.B=function(a){for(var b=new Uint8Array(a.initData),c=0;c<this.c.length;++c)if(ua(b,this.c[c].data))return;try{var d=je(this)}catch(e){b=y(e);this.dispatchEvent(b);this.g.reject(e);return}a=d.generateRequest(a.initDataType,a.initData);this.c.push({data:b,La:d});a.catch(u(this,function(a){if(this.h){for(var b=0;b<this.c.length;++b)if(this.c[b].La==d){this.c.splice(b,1);break}b=y(a);this.dispatchEvent(b);this.g.reject(a)}}));this.f.push(d)};
function ie(a){for(var b=a.b.ua(),c=0;c<b.length;++c){var d=je(a),e=d.load(b[c]);a.f.push(d);e.then(u(a,function(){this.s++;this.s>=this.f.length&&this.g.resolve()})).catch(u(a,function(a){a=y(a);this.dispatchEvent(a)}))}}
function je(a){var b=null;if(a.b.ha())try{b=a.i.createSession("persistent-license")}catch(c){throw Error("Persistent licenses are not supported by this key system or platform.");}else b=a.i.createSession();D(a.l,b,"message",a.G.bind(a));D(a.l,b,"keystatuseschange",a.F.bind(a));return b}L.prototype.G=function(a){ke(this,a.target,this.a,a.message)};
L.prototype.F=function(a){a=a.target;var b={};a.keyStatuses.forEach(function(a,c){if("string"==typeof a){var f=a;a=c;c=f}if("com.microsoft.playready"==this.a.a&&16==a.byteLength){var f=new DataView(a),g=f.getUint32(0,!0),h=f.getUint16(4,!0),l=f.getUint16(6,!0);f.setUint32(0,g,!1);f.setUint16(4,h,!1);f.setUint16(6,l,!1)}f=ta(new Uint8Array(a));b[f]=c}.bind(this));if(a.expiration<Date.now()){for(var c=0;c<this.c.length;++c)if(this.c[c].La==a){this.c.splice(c,1);break}a.close();this.f.splice(this.f.indexOf(a),
1)}this.b.cb(b)};function ke(a,b,c,d){d=le(c,d);Sd(new Rd(d.url,d.body,d.method,c.i,d.headers,a.w)).then(u(a,function(a){c.l&&(a=c.l(a));return b.update(a)})).then(u(a,function(){var a=x({type:"sessionReady",detail:b});this.dispatchEvent(a);this.s++;this.s>=this.f.length&&this.g.resolve()})).catch(u(a,function(a){a.La=b;a=y(a);this.dispatchEvent(a)}))}
function le(a,b){var c={url:a.h,body:b.slice(0),method:"POST",headers:{}};if("com.microsoft.playready"===a.a){for(var d=String.fromCharCode.apply(null,new Uint16Array(c.body)),d=(new DOMParser).parseFromString(d,"application/xml"),e=d.getElementsByTagName("name"),f=d.getElementsByTagName("value"),g=0;g<e.length;g++)c.headers[e[g].childNodes[0].nodeValue]=f[g].childNodes[0].nodeValue;c.body=window.atob(d.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)}if(!a.s)return c;a.s(c);c.url=ka(c,
"url");if(null==c.url)throw Error("'url' cannot be null.");if(!(c.body instanceof ArrayBuffer||"string"==typeof c.body||null==c.body))throw new TypeError("'body' must be an ArrayBuffer, a string, or null.");c.method=ka(c,"method");if("GET"!=c.method&&"POST"!=c.method)throw Error("'method' must be either 'GET' or 'POST'.");c.headers=la(c,"headers",Object);if(null==c.headers)throw Error("'headers' cannot be null.");return c};function N(a){z.call(this,null);this.a=a;this.b=null;this.f=new C;this.j=this.i=null;this.D=0;this.w=null;this.h=!1;this.g=new Nd;this.c={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:0,mpdRequestTimeout:0,segmentRequestTimeout:0,preferredLanguage:"en",restrictions:new ca};this.l=1;this.F=null}q(N,z);p("shaka.player.Player",N);N.version="v1.6.4";
N.isBrowserSupported=function(){return!!window.MediaSource&&!!window.MediaKeys&&!!window.navigator&&!!window.navigator.requestMediaKeySystemAccess&&!!window.MediaKeySystemAccess&&!!window.MediaKeySystemAccess.prototype.getConfiguration&&!!window.Promise&&!!Element.prototype.requestFullscreen&&!!document.exitFullscreen&&"fullscreenElement"in document&&!!window.Uint8Array};function Td(a){return"text/vtt"==a?!!window.VTTCue:MediaSource.isTypeSupported(a)}N.isTypeSupported=Td;
N.setTextStyle=function(a){var b=document.getElementById("ShakaPlayerTextStyle");b||(b=document.createElement("style"),b.id="ShakaPlayerTextStyle",document.head.appendChild(b));for(b=b.sheet;b.cssRules.length;)b.deleteRule(0);b.insertRule("::cue { "+Pb(a)+" }",0)};N.prototype.destroy=function(){return this.s().then(u(this,function(){this.f.destroy();this.a=this.f=null})).catch(function(){})};N.prototype.destroy=N.prototype.destroy;
N.prototype.s=function(){if(!this.b)return Promise.resolve();this.h&&me(this);this.a.pause();gb(this.f);ne(this);oe(this);this.i&&(this.i.destroy(),this.i=null);this.a.src="";var a=this.a.setMediaKeys(null);this.b&&(this.b.destroy(),this.b=null);this.h=!1;this.g=new Nd;return a};N.prototype.unload=N.prototype.s;
N.prototype.ea=function(a){var b=this.s();this.a.autoplay&&(Sb("load"),D(this.f,this.a,"timeupdate",this.wb.bind(this)));a.T(this.c);a.pb(this.F);this.F=null;b=b.then(u(this,function(){return a.X()}));b.catch(u(this,function(b){a.destroy();return Promise.reject(b)}));return b.then(u(this,function(){if(!this.a)return pe();this.b=a;D(this.f,this.b,"seekrangechanged",this.Fb.bind(this));this.i=new L(this,this.a,this.b);return this.i.initialize()})).then(u(this,function(){if(!this.a)return pe();D(this.f,
this.a,"error",this.Rb.bind(this));D(this.f,this.a,"playing",this.Db.bind(this));D(this.f,this.a,"pause",this.Cb.bind(this));return this.b.lb(this,this.a)})).then(u(this,function(){return this.a?he(this.i):pe()})).then(u(this,function(){if(!this.a)return pe();qe(this)})).catch(u(this,function(a){if(!this.a)return pe();if("destroy"!=a.type){var b=y(a);this.dispatchEvent(b)}return this.s().then(function(){return Promise.reject(a)})}))};N.prototype.load=N.prototype.ea;
function pe(){var a=Error("Player destroyed");a.type="destroy";return Promise.reject(a)}k=N.prototype;k.wb=function(){Vb("load");this.g.playbackLatency=Wb("load")/1E3;this.f.sa(this.a,"timeupdate")};k.Rb=function(){if(this.a.error){var a=this.a.error.code;a!=MediaError.MEDIA_ERR_ABORTED&&(a=Error(re[a]||"Unknown playback error."),a.type="playback",a=y(a),this.dispatchEvent(a))}};
k.Db=function(){Sb("playing");!this.j&&0>this.l&&(this.a.playbackRate=0,this.B(this.a.currentTime,Date.now(),this.l));this.h&&me(this)};k.Cb=function(){Vb("playing");var a=Wb("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3}oe(this)};k.Fb=function(a){this.D=a.start};
k.qb=function(){if(!this.a.paused){Vb("playing");var a=Wb("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3;Sb("playing")}}a=this.g;b=this.a;b.getVideoPlaybackQuality&&(b=b.getVideoPlaybackQuality(),a.decodedFrames=b.totalVideoFrames,a.droppedFrames=b.droppedVideoFrames);return this.g};N.prototype.getStats=N.prototype.qb;N.prototype.da=function(){return this.b?this.b.ma():[]};N.prototype.getVideoTracks=N.prototype.da;N.prototype.Y=function(){return this.b?this.b.pa():[]};
N.prototype.getAudioTracks=N.prototype.Y;N.prototype.$=function(){return this.b?this.b.Oa():[]};N.prototype.getTextTracks=N.prototype.$;N.prototype.selectVideoTrack=function(a,b){return this.b?this.b.selectVideoTrack(a,void 0==b?!0:b):!1};N.prototype.selectVideoTrack=N.prototype.selectVideoTrack;N.prototype.M=function(a,b,c){return this.b?this.b.nb(a,void 0==b?!0:b,c):!1};N.prototype.selectAudioTrack=N.prototype.M;N.prototype.fa=function(a){return this.b?this.b.ob(a,!1):!1};
N.prototype.selectTextTrack=N.prototype.fa;N.prototype.V=function(a){this.b&&this.b.Na(a)};N.prototype.enableTextTrack=N.prototype.V;N.prototype.T=function(a){oe(this);0<=a?this.a.playbackRate=a:this.a.paused||(this.a.playbackRate=0,this.B(this.a.currentTime,Date.now(),a));this.l=a};N.prototype.setPlaybackRate=N.prototype.T;N.prototype.K=function(){return this.l};N.prototype.getPlaybackRate=N.prototype.K;N.prototype.R=function(a){this.F=a};N.prototype.setPlaybackStartTime=N.prototype.R;
N.prototype.G=function(){return this.b?this.b.mb():!1};N.prototype.isLive=N.prototype.G;
N.prototype.U=function(a){if(a){var b=ha(a,"enableAdaptation");null!=b&&(this.c.enableAdaptation=b);b=ja(a,"streamBufferSize");null!=b&&(this.c.streamBufferSize=b);b=ja(a,"liveStreamEndTimeout");null!=b&&(this.c.liveStreamEndTimeout=b);b=ja(a,"licenseRequestTimeout");null!=b&&(this.c.licenseRequestTimeout=b);b=ja(a,"mpdRequestTimeout");null!=b&&(this.c.mpdRequestTimeout=b);b=ja(a,"segmentRequestTimeout");null!=b&&(this.c.segmentRequestTimeout=b);b=ka(a,"preferredLanguage");null!=b&&(this.c.preferredLanguage=
b);b=la(a,"restrictions",ca);null!=b&&(this.c.restrictions=b.clone());a=ha(a,"disableCacheBustingEvenThoughItMayAffectBandwidthEstimation");null!=a&&(ed=!a);this.b&&this.b.T(this.c)}};N.prototype.configure=N.prototype.U;N.prototype.Z=function(){return this.c};N.prototype.getConfiguration=N.prototype.Z;function oe(a){a.j&&(window.clearTimeout(a.j),a.j=null)}function qe(a){ne(a);a.w=window.setTimeout(a.L.bind(a),100)}function ne(a){a.w&&(window.clearTimeout(a.w),a.w=null)}
N.prototype.B=function(a,b,c){this.j=null;var d=(Date.now()-b)/1E3*c;this.a.currentTime<this.D+(this.G()?1:.05)?this.a.pause():(d=Math.max(this.D,a+d),this.a.currentTime=d,this.j=window.setTimeout(this.B.bind(this,a,b,c),250))};function me(a){Vb("buffering");var b=a.g;b.bufferingTime+=Wb("buffering")/1E3;a.h=!1;a.dispatchEvent(x({type:"bufferingEnd"}))}
N.prototype.L=function(){qe(this);if(!this.a.ended&&!this.a.seeking){var a=this.a.buffered,b=a.length?a.end(a.length-1):0,a=Math.max(b-this.a.currentTime,0),c=this.a.duration,c=isNaN(c)?0:Math.max(c-.05,0),b=b>=c||this.a.currentTime>=c;if(this.h){if(c=this.b.$a(),b||a>c)me(this),this.a.play()}else!this.a.paused&&!b&&.5>a&&(this.h=!0,this.a.pause(),this.g.bufferingHistory.push(Ha()/1E3),Sb("buffering"),this.dispatchEvent(x({type:"bufferingStart"})))}};
var re={2:"A network failure occured while loading media content.",3:"The browser failed to decode the media content.",4:"The browser does not support the media content."};function se(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d){for(var e=c.a[d],f=e,g=0;g<f.m.length;++g)Td(xd(f.m[g]))||(f.m.splice(g,1),--g);0==e.m.length&&(c.a.splice(d,1),--d)}}function te(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d)c.a[d].m.sort(ue)}function ue(a,b){var c=a.bandwidth||Number.MAX_VALUE,d=b.bandwidth||Number.MAX_VALUE;return c<d?-1:c>d?1:0};function ve(a){this.a=a}ve.prototype.destroy=function(){this.a.destroy();this.a=null};ve.prototype.update=function(a){var b=we(a),c=we(this.a);return Promise.all([b,c]).then(u(this,function(b){var c=b[0];b=b[1];var f=this.a.a;se(f);te(f);a.f=this.a.f;a.g=this.a.g?this.a.g.clone():null;a.c=this.a.c;f=[];xe(a,this.a,c,b,f);c=a.a;se(c);te(c);return Promise.resolve(f)}))};
function we(a){function b(a,b){return a.concat(b)}var c=a.a.map(function(a){return a.a}).reduce(b,[]).map(function(a){return a.m}).reduce(b,[]);a=c.map(function(a){return a.I.create()});return Promise.all(a).then(function(a){for(var b={},f=0;f<c.length;++f)b[c[f].C]=a[f];return Promise.resolve(b)})}
function xe(a,b,c,d,e){var f=new w;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new w;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=Ga(f);for(b=0;b<a.length;++b){var h=a[b],l=f.get(h);1<l.length||(h=g.get(h))&&0!=h.length&&1==h.length&&(ye(l[0],h[0],c,d,e),l[0].b=h[0].b)}}
function ye(a,b,c,d,e){var f=new w;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new w;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=Ga(f);for(b=0;b<a.length;++b){var h=a[b],l=f.get(h);1<l.length||(h=g.get(h))&&0!=h.length&&1==h.length&&ze(l[0],h[0],c,d,e)}}
function ze(a,b,c,d,e){var f=new w;a.m.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new w;b.m.forEach(function(a,b){g.push(a.id||""+b,a)});b={};for(var h=Ga(f),l=0;l<h.length;++l){var m=h[l];b[m]=m;var n=f.get(m);1<n.length||((m=g.get(m))&&0!=m.length?1==m.length&&(Ae(n[0],m[0],c,d),n[0].H=m[0].H,m[0].H=null,n[0].c=m[0].c):(e.push(n[0]),a.m.splice(a.m.indexOf(n[0]),1)))}h=Ga(g);for(l=0;l<h.length;++l)m=h[l],b[m]||(b[m]=m,m=g.get(m),a.m.push(m[0]))}
function Ae(a,b,c,d){a=c[a.C];b=d[b.C];a.length();a.Ha(b)&&a.length()};function O(){this.a=this.b=null;this.f=new C;this.c=Number.POSITIVE_INFINITY;this.i=!0;this.g=!1}p("shaka.media.SimpleAbrManager",O);O.prototype.destroy=function(){this.f.destroy();this.a=this.b=this.f=null};O.prototype.initialize=function(a,b){this.b||this.a||(this.b=a,this.a=b)};
O.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=Date.now()+4E3,D(this.f,this.b,"bandwidth",this.v.bind(this)),D(this.f,this.a,"adaptation",this.j.bind(this)),D(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)};O.prototype.enable=function(a){this.i=a};O.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var a=Be(this);return a?a.id:null};O.prototype.selectVideoTrack=function(a,b,c){this.g&&this.a.selectVideoTrack(a.id,b,c)};
O.prototype.v=function(){Date.now()<this.c||this.h()};O.prototype.h=function(){if(this.i){var a=Be(this);if(a){if(a.active){this.c=Date.now()+3E3;return}this.selectVideoTrack(a,!1)}this.c=Number.POSITIVE_INFINITY}};O.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=Date.now()+3E4)};
function Be(a){var b=a.a.ma();if(0==b.length)return null;b.sort(ea);var c;a:{c=a.a.pa();for(var d=0;d<c.length;++d)if(c[d].active){c=c[d];break a}c=null}c=c?c.bandwidth:0;a=a.b.getBandwidth();for(var d=b[0],e=0;e<b.length;++e){var f=b[e],g=e+1<b.length?b[e+1]:{bandwidth:Number.POSITIVE_INFINITY};if(f.bandwidth&&(g=(g.bandwidth+c)/.85,a>=(f.bandwidth+c)/.95&&a<=g&&(d=f,d.active)))break}return d};function Ce(a,b,c){z.call(this,null);this.f=a;this.c=b;this.b=La(c);this.a=null}q(Ce,z);p("shaka.player.HttpVideoSource",Ce);Ce.prototype.T=function(){};Ce.prototype.destroy=function(){this.a&&(this.a.parentElement.removeChild(this.a),this.a=null);this.v=this.b=null};k=Ce.prototype;k.lb=function(a,b){this.v=a;var c=b.mediaKeys;b.src=this.f;c=b.setMediaKeys(c);this.c&&(this.a=document.createElement("track"),this.a.src=this.c,b.appendChild(this.a),this.a.track.mode="showing");return c};k.X=function(){return Promise.resolve()};
k.ma=function(){return[]};k.pa=function(){return[]};k.Oa=function(){return[]};k.$a=function(){return 5};k.ab=function(){var a=new Bd;a.a=this.b;return[a]};k.Ka=function(){};Ce.prototype.selectVideoTrack=function(){return!1};k=Ce.prototype;k.nb=function(){return!1};k.ob=function(){return!1};k.Na=function(a){this.a&&(this.a.track.mode=a?"showing":"disabled")};k.pb=function(){};k.ua=function(){return[]};k.ha=function(){return!1};k.mb=function(){return!1};
k.cb=function(a){for(var b in a){var c=a[b],d=oa[c]||null;if(d){var e=ma(b),d=Error("Key "+e+" is not usable. "+d);d.type="drm";d.code=c;c=y(d);this.dispatchEvent(c)}}};function P(a,b,c){z.call(this,null);this.a=a;this.Z=b;this.i=new C;this.g=new MediaSource;this.f=null;this.da=0;this.b=new w;this.G=c;this.G.initialize(b,this);this.L=!1;this.K="en";this.fa=!1;this.U=null;this.B=new r;this.h=new ca;this.D=null;this.Va=1;this.c={};this.ea=new r;this.Ta=0;this.Ua=15;this.w=null;this.Ra=this.Sa=!1;this.s={};this.$=this.Y=this.V=null;this.F={}}q(P,z);p("shaka.player.StreamVideoSource",P);
P.prototype.T=function(a){null!=a.streamBufferSize&&(this.F.streamBufferSize=a.streamBufferSize);null!=a.segmentRequestTimeout&&(this.F.segmentRequestTimeout=a.segmentRequestTimeout);De(this);null!=a.enableAdaptation&&this.G.enable(Boolean(a.enableAdaptation));null!=a.mpdRequestTimeout&&(this.da=Number(a.mpdRequestTimeout));null!=a.liveStreamEndTimeout&&(this.Ua=Number(a.liveStreamEndTimeout));null!=a.preferredLanguage&&(this.K=Sa(String(a.preferredLanguage)));null!=a.restrictions&&(this.h=a.restrictions,
this.L&&Ee(this))};P.prototype.destroy=function(){this.B.destroy();this.ea.destroy();this.ea=this.B=null;this.Y&&(window.clearTimeout(this.Y),this.Y=null);this.V&&(window.clearTimeout(this.V),this.V=null);this.s=null;this.i.destroy();this.i=null;ga(this.c).forEach(function(a){a.destroy()});this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null);this.G.destroy();this.v=this.h=this.U=this.f=this.g=this.Z=this.G=null};k=P.prototype;
k.lb=function(a,b){if(!this.L){var c=Error("Cannot call attach() right now.");c.type="app";return Promise.reject(c)}this.v=a;this.f=b;this.U=a.qb();D(this.i,this.g,"sourceopen",this.yb.bind(this));D(this.i,this.Z,"bandwidth",this.Sb.bind(this));this.a.b&&(D(this.i,a,"bufferingStart",this.vb.bind(this)),D(this.i,a,"bufferingEnd",this.ub.bind(this)));c=this.f.mediaKeys;this.f.src=window.URL.createObjectURL(this.g);c=this.f.setMediaKeys(c);return Promise.all([this.B,c])};
k.X=function(){if(this.L){var a=Error("Cannot call load() right now.");a.type="app";return Promise.reject(a)}if(!this.a||0==this.a.a.length)return a=Error("The manifest does not specify any content."),a.type="stream",Promise.reject(a);a=this.a.a;se(a);te(a);if(0==this.a.a.length||0==this.a.a[0].a.length)return a=Error("The manifest specifies content that cannot be displayed on this browser/platform."),a.type="stream",Promise.reject(a);this.L=!0;this.F.initialStreamBufferSize=this.a.c;De(this);Ee(this);
return Promise.resolve()};k.gb=function(a){var b=Date.now(),c=this.V=null,d=this.a.g;(a?this.eb():this.fb(d)).then(u(this,function(a){c=new ve(a);return c.update(this.a)})).then(u(this,function(a){c.destroy();c=null;for(var d=0;d<a.length;++d)Fe(this,a[d]);this.F.initialStreamBufferSize=this.a.c;De(this);Ee(this);0==Object.keys(this.c).length?Ge(this):He(this,(Date.now()-b)/1E3)})).catch(u(this,function(a){c&&(c.destroy(),c=null);"aborted"!=a.type&&(a=y(a),this.dispatchEvent(a),this.a&&He(this,0))}))};
k.fb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};k.eb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};function He(a,b){if(null!=a.a.f){var c=Math.max(a.a.f,3),c=Math.max(c-b,0);a.V=window.setTimeout(a.gb.bind(a,!1),1E3*c)}}
function Fe(a,b){var c=b.a.split("/")[0],d=a.c[c];if(d&&d.oa()==b){var e=a.b.get(b.a.split("/")[0]).map(function(a){return a.m}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return a.N&&a.J});if(0==e.length){c=Error("All usable streams have been removed from the manifest.");c.type="app";c=y(c);a.dispatchEvent(c);return}a.s[c].Pa==b&&delete a.s[c];d.ra(e[0],!0);b.destroy()}b.destroy()}
k.ma=function(){if(!this.b.a.hasOwnProperty("video"))return[];for(var a=this.c.video,a=(a=a?a.oa():null)?a.C:0,b=[],c=this.b.get("video"),d=0;d<c.length;++d)for(var e=c[d],f=0;f<e.m.length;++f){var g=e.m[f];if(g.N&&g.J){var h=g.C,g=new da(h,g.bandwidth,g.width,g.height);h==a&&(g.active=!0);b.push(g)}}return b};P.prototype.getVideoTracks=P.prototype.ma;
P.prototype.pa=function(){if(!this.b.a.hasOwnProperty("audio"))return[];for(var a=this.c.audio,a=(a=a?a.oa():null)?a.C:0,b=[],c=this.b.get("audio"),d=0;d<c.length;++d)for(var e=c[d],f=e.lang,g=0;g<e.m.length;++g){var h=e.m[g];if(h.N&&h.J){var l=h.C,h=new fa(l,h.bandwidth,f);l==a&&(h.active=!0);b.push(h)}}return b};P.prototype.getAudioTracks=P.prototype.pa;
P.prototype.Oa=function(){if(!this.b.a.hasOwnProperty("text"))return[];for(var a=this.c.text,b=a?a.oa():null,b=b?b.C:0,c=[],d=this.b.get("text"),e=0;e<d.length;++e)for(var f=d[e],g=f.lang,h=0;h<f.m.length;++h){var l=f.m[h].C,m=new ba(l,g);l==b&&(m.active=!0,m.enabled=a.Da());c.push(m)}return c};P.prototype.getTextTracks=P.prototype.Oa;P.prototype.$a=function(){return Number(this.F.initialStreamBufferSize)};
P.prototype.ab=function(){var a;if(this.L){a=this.a.a[0];for(var b=[],c=0;c<a.a.length;++c)b.push.apply(b,Ad(a.a[c]));a=b}else a=[];return a};
P.prototype.Ka=function(a){if(this.L){for(var b={},c=this.a.a[0],d=0;d<c.a.length;++d){var e=c.a[d];b[e.C]=e}this.b.a={};c=Ga(a);for(d=0;d<c.length;++d){var e=c[d],f=a.get(e);if("video"==e){var g=f[0].id;this.b.push(e,b[g])}else if("audio"==e)for(var g=f[0].b.split(";")[0],h=0;h<f.length;++h){var l=f[h];l.b.split(";")[0]==g&&this.b.push(e,b[l.id])}else for(h=0;h<f.length;++h)g=f[h].id,this.b.push(e,b[g])}this.fa=!0;if(a=this.b.get("audio"))Ie(this,a),this.b.set("audio",a),a=a[0].lang||this.K,Ra(2,
this.K,a)&&(this.fa=!1);if(a=this.b.get("text"))Ie(this,a),this.b.set("text",a),a=a[0].lang||this.K,Ra(2,this.K,a)||(this.fa=!1)}};P.prototype.selectVideoTrack=function(a,b,c){return Je(this,"video",a,b,c)};k=P.prototype;k.nb=function(a,b,c){return Je(this,"audio",a,b,c)};k.ob=function(a,b){return Je(this,"text",a,b)};k.Na=function(a){var b=this.c.text;b&&b.va(a)};k.pb=function(a){this.$=a};
function Ee(a){if(a.h){for(var b=!1,c=0;c<a.a.a.length;++c)for(var d=a.a.a[c],e=0;e<d.a.length;++e){var f=d.a[e];if("video"==f.contentType)for(var g=0;g<f.m.length;++g){var h=f.m[g],l=h.J;h.J=!0;a.h.maxWidth&&h.width>a.h.maxWidth&&(h.J=!1);a.h.maxHeight&&h.height>a.h.maxHeight&&(h.J=!1);a.h.minHeight&&h.height<a.h.minHeight&&(h.J=!1);a.h.maxBandwidth&&h.bandwidth>a.h.maxBandwidth&&(h.J=!1);a.h.minBandwidth&&h.bandwidth<a.h.minBandwidth&&(h.J=!1);l!=h.J&&(b=!0)}}0!=Da(a.b).length&&b&&(Ke(a),0<a.ma().length||
(b=Error("The application has restricted all video tracks!"),b.type="app",b=y(b),a.dispatchEvent(b)))}}k.ua=function(){return[]};k.ha=function(){return!1};k.mb=function(){return this.a?this.a.b:!1};
k.cb=function(a){for(var b,c=!1,d=new w,e=Da(this.b),f=0;f<e.length;++f)for(var g=e[f],h=0;h<g.m.length;++h){var l=g.m[h];l.f.forEach(function(a){d.push(a,l)})}for(b in a)if(e=oa[a[b]]||null,g=d.get(b))for(f=0;f<g.length;++f)l=g[f],h=l.N,l.N=!e,h!=l.N&&(c=!0);else ma(b);c&&(Ke(this),b=this.pa(),a=this.ma(),b=this.b.a.hasOwnProperty("audio")&&0==b.length,a=this.b.a.hasOwnProperty("video")&&0==a.length,b||a)&&(a=Error("The key system has restricted all "+(b&&a?"audio and video tracks.":b?"audio tracks.":
"video tracks.")),a.type="drm",a=y(a),this.dispatchEvent(a))};function Ke(a){var b=x({type:"trackschanged",bubbles:!0});a.dispatchEvent(b)}function Je(a,b,c,d,e){if(!a.b.a.hasOwnProperty(b)||!a.c[b])return!1;for(var f=a.b.get(b),g=0;g<f.length;++g)for(var h=f[g],l=0;l<h.m.length;++l){var m=h.m[l];if(m.C==c){if(!m.N||!m.J)return!1;if("text"!=b&&!a.Ra)return c=a.s[b],a.s[b]={Pa:m,Wa:null!=c&&c.Wa||d,Xa:null!=c&&c.Xa||e},!0;Od(a.U,m);a.c[b].ra(m,d,e);return!0}}return!1}
function Ie(a,b){for(var c=0;2>=c;++c)for(var d=0;d<b.length;++d){var e=b[d];if(Ra(c,a.K,e.lang)){b.splice(d,1);b.splice(0,0,e);return}}for(d=0;d<b.length;++d)if(e=b[d],e.b){b.splice(d,1);b.splice(0,0,e);break}}k.yb=function(){this.i.sa(this.g,"sourceopen");Ge(this).then(u(this,function(){this.B&&this.B.resolve()})).catch(u(this,function(a){this.B&&this.B.reject(a)}))};
function Ge(a){for(var b=[],c=["audio","video","text"],d=0;d<c.length;++d){var e=c[d];a.b.a.hasOwnProperty(e)&&b.push(a.b.get(e)[0])}for(var f=Le(a,b),d=0;d<c.length;++d)if(e=c[d],a.b.a.hasOwnProperty(e)&&!f[e])return a=Error("Unable to select an initial "+e+" stream: all "+e+" streams have been restricted (by the application or by the key system)."),a.type="stream",Promise.reject(a);b=ga(f).map(function(a){return a.I.create()});return Promise.all(b).then(u(a,function(a){if(!a.every(function(a){return a.length()}))return a=
Error("Some streams are not available."),a.type="stream",Promise.reject(a);a=Me(this,a);if(!a)return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);if(!Ne(this,f))return a=Error("Failed to create Stream objects."),a.type="stream",Promise.reject(a);this.G.start();Oe(this,f,a);return Promise.resolve()})).catch(u(a,function(a){if("aborted"!=a.type)return Object.keys(this.c),this.a.b?(Ha()<this.a.h?(a=Math.max(this.a.h-Date.now()/1E3,3),this.V=window.setTimeout(this.gb.bind(this,
!0),1E3*a)):He(this,0),Promise.resolve()):Promise.reject(a)}))}function Le(a,b){for(var c={},d=0;d<b.length;++d){var e=b[d],f=null;if("video"==e.contentType){var g=a.G.getInitialVideoTrackId();if(null==g)continue;f=e.m.filter(function(a){return a.C==g});if(0==f.length)continue;f=f[0]}else if("audio"==e.contentType){f=e.m.filter(function(a){return a.N&&a.J});if(0==f.length)continue;f=e.m[Math.floor(f.length/2)]}else 0<e.m.length&&(f=e.m[0]);c[e.contentType]=f}return c}
function Ne(a,b){var c={},d;for(d in b){var e=b[d],e="text"==d?new Ed(a,a.f):Pe(a,e);if(!e)return ga(c).forEach(function(a){a.destroy()}),!1;c[d]=e}a.c=c;return!0}function Pe(a,b){var c=new Fd(a,a.f,a.g,xd(b),a.Z);c.F(a.F);return c}
function Oe(a,b,c){a.Va=a.f.playbackRate;a.f.playbackRate=0;Qe(a,c);var d;a.$&&a.$<=c.end&&a.$>=c.start?d=a.$:a.a.b?(d=c.end,a.Sa=!0):d=c.start;D(a.i,a.f,"seeking",a.Gb.bind(a));a.f.currentTime!=d&&(a.f.currentTime=d,a.D=d);Re(a,c.start,c.end);c=[];for(var e in a.c){d=a.c[e];c.push(d.sb(a.ea));D(a.i,d,"ended",a.Hb.bind(a));var f=b[e];Od(a.U,f);d.ra(f,!1)}Promise.all(c).then(a.tb.bind(a)).catch(u(a,function(a){"destroy"!=a.type&&(a=y(a),this.dispatchEvent(a))}));a.Na(a.fa)}
k.tb=function(a){Ja(a&&a.length==Object.keys(this.c).length);for(var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=0;d<a.length;++d)var e=a[d],b=Math.min(b,e),c=Math.max(c,e);a=Se(this);for(d=0;d<a.length;++d)a[d].ka(c);Te(this,a,c);d=Da(this.b).map(function(a){return a.m}).reduce(function(a,b){return a.concat(b)},[]).map(function(a){var b=[a.I.create()];a.H&&b.push(a.H.create());return Promise.all(b)});Promise.all(d).then(u(this,function(a){for(var b=0;b<a.length;++b)a[b][0].ka(c);this.Ra=
!0;for(var d in this.s)a=this.s[d],b=this.c[d],Od(this.U,a.Pa),b.ra(a.Pa,a.Wa,a.Xa);this.s={}})).catch(u(this,function(a){"aborted"!=a.type&&(a=y(a),this.dispatchEvent(a))}))};function Te(a,b,c){if(b=Me(a,b))Qe(a,b),Re(a,b.start,b.end);0!=c&&(c=a.f.currentTime+c,a.f.currentTime=c,a.D=c);a.Sa&&b&&(a.f.currentTime=b.end);a.f.playbackRate=a.Va;a.a.b&&null!=a.a.f&&He(a,0);Ue(a);a.ea.resolve()}
function Qe(a,b){if(a.a.b)isNaN(a.g.duration)&&(a.g.duration=b.end+2592E3);else if(isNaN(a.g.duration)||b.end>a.g.duration){a.g.duration=b.end;for(var c=0;c<a.g.sourceBuffers.length;++c)a.g.sourceBuffers[c].appendWindowEnd=b.end}}k.Jb=function(){this.Y=null;Ue(this);var a=Me(this,Se(this));a&&(this.a.b&&this.Ta!=a.A&&(this.Ta=a.A,null!=this.w&&(window.clearTimeout(this.w),this.w=null)),Re(this,a.start,a.end),this.f.paused||Ve(this,this.f.currentTime,a.start,a.end))};
function Re(a,b,c){b=x({type:"seekrangechanged",bubbles:!0,start:b,end:c});a.dispatchEvent(b)}k.Gb=function(){var a=this.f.currentTime;if(null!=this.D){if(a>=this.D-.01&&a<=this.D+.01){this.D=null;return}this.D=null}var b=Me(this,Se(this));if(b){var c=b.end;(b=Ve(this,a,b.start,c))||(a<=c+.01?b=!1:(this.f.currentTime=c,b=!0));if(!b)for(var d in this.c)this.c[d].jb()}};
function Ve(a,b,c,d){if(b>=c-.01)return!1;b=0;if(a.a.b){b=.5;for(var e in a.c)if(!a.c[e].kb(c+b)){b=a.a.c;break}}a.f.currentTime=Math.min(c+b,d);return!0}k.Hb=function(){if(!this.a.b){for(var a in this.c)if(!this.c[a].Ga())return;this.Za()}};k.vb=function(){ga(this.c).every(function(a){return a.Ga()})&&(this.w=window.setTimeout(this.Za.bind(this),1E3*this.Ua))};k.ub=function(){null!=this.w&&(window.clearTimeout(this.w),this.w=null)};
k.Sb=function(){var a=this.U,b=this.Z.getBandwidth();a.estimatedBandwidth=b;a.bandwidthHistory.push(new Qd(b))};k.Za=function(){this.w=null;this.g.endOfStream()};function Se(a){return ga(a.c).map(function(a){return a.bb()}).filter(function(a){return null!=a})}
function Me(a,b){for(var c=0,d=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,f=0;f<b.length;++f){var g=b[f].Ea(),c=Math.max(c,g.start);null!=g.end&&(d=Math.min(d,g.end));b[f].length()&&(e=Math.min(e,b[f].A().a))}if(d==Number.POSITIVE_INFINITY)if(d=a.a.a[0],d.b)d=(d.start||0)+d.b;else return null;a.a.b&&(d=Math.max(d-a.a.c,c));return c>d?null:{start:c,end:d,A:e}}function Ue(a){a.a.b&&(a.Y=window.setTimeout(a.Jb.bind(a),1E3))}function De(a){for(var b in a.c)a.c[b].F(a.F)};function We(a,b){ib.call(this,"readwrite",b);this.j=a;this.b=0}q(We,ib);
function Xe(a,b,c,d,e){for(var f=[],g=[],h=0,l=0,m=[],n=b.map(function(a){return a.I.create()}),n=Promise.all(n),t=b.map(function(a){return a.H.create()}),t=Promise.all(t),n=Promise.all([n,t]).then(function(a){f=a[0];g=a[1];h=f.reduce(function(a,b){return a+b.length()},0)}),t=0;t<b.length;++t)n=n.then(function(a){return Ye(this,b[a],f[a],g[a],h,l)}.bind(a,t)),n=n.then(function(a,b){l+=f[a].length();m.push(b)}.bind(a,t));return n.then(u(a,function(){return Ze(pb(this))})).then(u(a,function(a){var b=
new r;c=na(c);var f={group_id:a,stream_ids:m,session_ids:c,duration:d,key_system:e.a,license_server:e.h,with_credentials:e.i,distinctive_identifier:e.g,audio_robustness:e.f,video_robustness:e.j},g=pb(this).put(f);g.onsuccess=function(){b.resolve(a)};g.onerror=function(){b.reject(g.error)};return b}))}function $e(a,b){return qb(pb(a),b).then(u(a,function(a){var d=[],e;for(e in a.stream_ids)d.push(af(this,a.stream_ids[e]));a=pb(this);d.push(a.delete(b));return Promise.all(d)}))}
function Ye(a,b,c,d,e,f){var g=[Ze(ob(a)),Ze(mb(a).index("stream"))],g=Promise.all(g).then(u(a,function(a){return{qa:Math.max(a[0],a[1]),ja:new ArrayBuffer(0),Ja:0,o:[],Ca:null,Vb:e,ib:f}})),g=g.then(a.f.bind(a,c));return g=g.then(a.g.bind(a,b,d))}function Ze(a){var b=new r,c=a.openCursor(null,"prev");c.onsuccess=function(a){a.target.result?b.resolve(a.target.result.key+1):b.resolve(0)};c.onerror=function(){b.reject(c.error)};return b}
We.prototype.g=function(a,b,c){var d=new r;a={stream_id:c.qa,mime_type:a.a,codecs:a.b,init_segment:b,references:c.o};var e=ob(this).put(a);e.onsuccess=function(){d.resolve(c.qa)};e.onerror=function(){d.reject(e.error)};return d};We.prototype.f=function(a,b){for(var c=Promise.resolve(),d=0;d<a.length();++d)var e=a.get(d),f=d==a.length()-1,f=this.c.bind(this,e,b,f),c=c.then(this.i.bind(this,e)),c=c.then(f);return c.then(function(){return Promise.resolve(b)}).catch(u(this,function(a){af(this,b.qa);return Promise.reject(a)}))};
We.prototype.c=function(a,b,c,d){var e=new r;0==b.ja.byteLength&&(b.Ca=a);b.ja=bf(b.ja,d);b.ib++;var f=x({type:"progress",detail:b.ib/b.Vb*100,bubbles:!0});if(1048576<=b.ja.byteLength||c){c={stream_id:b.qa,segment_id:b.Ja,content:b.ja};var g=mb(this).put(c);b.o.push({start_time:b.Ca.b,start_byte:b.Ca.url.f,end_time:a.a,url:"idb://"+b.qa+"/"+b.Ja});b.Ja++;b.ja=new ArrayBuffer(0);g.onerror=function(){e.reject(g.error)};g.onsuccess=u(this,function(){this.dispatchEvent(f);e.resolve()})}else this.dispatchEvent(f),
e.resolve();return e};function bf(a,b){var c=new Uint8Array(a.byteLength+b.byteLength);c.set(new Uint8Array(a),0);c.set(new Uint8Array(b),a.byteLength);return c.buffer}We.prototype.i=function(a){var b=new Cb;b.c=1E3*this.b;return Db(a.url,b,this.j)};
function af(a,b){var c=new r,d=ob(a).delete(b);d.onerror=function(){c.reject(d.error)};var e=mb(a);e.index("stream").openKeyCursor(IDBKeyRange.only(b)).onsuccess=function(a){if(a=a.target.result)e.delete(a.primaryKey),a.continue()};e.transaction.oncomplete=function(){c.resolve()};return c};function Q(a,b,c,d){J.call(this,a);this.g=b;this.w=c;this.f=d;this.h=this.g.b||this.g.a.reduce(function(a,b){return null==b.a?NaN:a+b.a},0)||0;this.a=this.l=this.c=null;cf(this)}q(Q,J);Q.prototype.destroy=function(){this.w=this.g=null;J.prototype.destroy.call(this)};Q.prototype.la=function(a){df(this,Ha()/1E3);return J.prototype.la.call(this,a)};Q.prototype.Ha=function(a){if(!(a instanceof Q))return!1;sd(this,a);this.h=Math.max(this.h,a.h);null==this.c?(this.f=a.f,cf(this)):ef(this);return!0};
function cf(a){ef(a);if(0!=a.length()){a.length();var b=null!=a.A().a?a.A().a:a.A().b;if(a.g.c>a.f)a.c=b;else{var c=a.f-(a.g.c+a.w.start);0>c?a.c=b:c<Math.max(a.A().b,a.A().a||0)?(a.A(),a.c=b):a.c=c}a.l=a.A().b;a.a=K(a).b}}Q.prototype.ka=function(a){a=J.prototype.ka.call(this,a);Math.min.apply(null,this.o.filter(function(a){return null!=a.a}).map(function(a){return a.a-a.b}));null!=this.c&&(this.l+=a,this.a+=a,this.c+=a);return a};Q.prototype.Ea=function(){return ff(this,Ha()/1E3)};
function ff(a,b){df(a,b);if(null==a.c||null==a.l||null==a.a)return{start:0,end:0};var c=Number.POSITIVE_INFINITY;a.h&&(c=a.h);var d=b-a.f,e=a.c+d;null!=a.g.f&&(e=e-a.a-a.g.f,0<e&&(a.a+=e));a.a=Math.min(a.a,c);d=a.l+d;if(d<a.a)return{start:a.a,end:a.a};d=0<a.length()?null!=a.A().a?Math.min(d,a.A().a):d:a.a;d=Math.max(d,a.a);d=Math.min(d,c);return{start:a.a,end:d}}
function df(a,b){ef(a);if(null!=a.g.f)if(null==a.c)a.length();else{for(var c=a.c+(b-a.f),d=0,e=0;e<a.o.length;++e){var f=null;e<a.o.length-1?f=a.o[e+1].a:(f=a.o[e],f=null!=f.a?f.a+(f.a-f.b):null);if(null!=f&&f<c-a.g.f)++d;else break}0<d&&a.o.splice(0,d)}}function ef(a){if(a.h){for(var b=0,c=a.o.length-1;0<=c;--c)if(a.o[c].b>a.h)++b;else break;0<b&&a.o.splice(-b)}};function gf(a,b,c,d,e,f,g){this.g=a;this.i=b;this.f=c;this.a=d;this.c=e;this.j=f;this.b=null;this.h=g}gf.prototype.destroy=function(){this.h=this.i=this.g=null;this.a.g();this.a=null;this.c&&(this.c.g(),this.c=null);this.b=null};
gf.prototype.create=function(){if(this.b)return this.b;var a=[Db(this.a)];"webm"==this.f&&a.push(Db(this.c));return this.b=Promise.all(a).then(u(this,function(a){var c=a[0];a=a[1]||null;var d=null;"mp4"==this.f?(d=new qd,d=d.parse(new DataView(c),this.a.f,this.a.b,this.h)):"webm"==this.f&&(d=new rd,d=d.parse(new DataView(c),new DataView(a),this.a.b,this.h));if(!d)return c=Error("Failed to parse SegmentReferences from "+this.a.toString()+" (or one of its fallbacks)."),c.type="stream",Promise.reject(c);
var e;"dynamic"==this.g.type?e=new Q(d,this.g,this.i,this.j):e=new J(d);return Promise.resolve(e)}))};function hf(a,b,c,d,e){this.b=a;this.c=b;this.f=c;this.h=d;this.a=null;this.g=e}hf.prototype.destroy=function(){this.g=this.f=this.c=this.b=null;this.a&&(this.a.destroy(),this.a=null)};
hf.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=this.f.a,b=jf(a.c,a.a||1,this.c.a||0),c=[],d=0;d<b.length;++d){var e=b[d].start,f=e/a.a,g=b[d].end/a.a,e=kf(this.g,this.f,d+a.j,e);if(!e)return a=Error("Failed to generate media URL."),a.type="dash",Promise.reject(a);var h=(a.i||0)/a.a;c.push(new nd(f-h,g-h,e))}"dynamic"==this.b.type?this.a=new Q(c,this.b,this.c,this.h):this.a=new J(c);return Promise.resolve(this.a)};function lf(){this.id=this.url=null;this.type="static";this.b=this.j=this.u=this.hb=null;this.h=5;this.f=this.c=this.g=null;this.i=1;this.a=[]}function mf(){this.g=this.f=this.c=this.u=this.a=this.start=this.id=null;this.b=[]}function nf(){this.i=this.b=this.height=this.width=this.contentType=this.lang=this.group=this.id=null;this.c=!1;this.h=this.g=this.f=this.u=null;this.j=[];this.a=[]}function of(){this.value=null}function pf(){this.contentType=this.lang=this.id=null}
function qf(){this.a=this.b=this.g=this.u=this.h=this.f=this.height=this.width=this.bandwidth=this.lang=this.id=null;this.c=[]}function rf(){this.b=this.a=this.c=this.f=null}function sf(){this.parsedPssh=this.psshBox=null}function tf(){this.url=null}function uf(){this.url=null}function wf(){this.u=null;this.g=1;this.c=this.b=this.a=this.f=null}wf.prototype.clone=function(){var a=new wf;a.u=xf(this.u);a.g=this.g;a.f=this.f;a.a=R(this.a);a.b=R(this.b);a.c=R(this.c);return a};
function yf(){this.a=this.url=null}yf.prototype.clone=function(){var a=new yf;a.url=xf(this.url);a.a=R(this.a);return a};function zf(){this.a=this.url=null}zf.prototype.clone=function(){var a=new zf;a.url=xf(this.url);a.a=R(this.a);return a};function Af(){this.u=null;this.f=1;this.b=this.g=null;this.i=1;this.h=null;this.a=[];this.c=null}Af.prototype.clone=function(){var a=new Af;a.u=xf(this.u);a.f=this.f;a.g=this.g;a.b=this.b;a.i=this.i;a.h=R(this.h);a.a=xf(this.a)||[];a.c=R(this.c);return a};
function Bf(){this.a=this.b=null}Bf.prototype.clone=function(){var a=new Bf;a.b=xf(this.b);a.a=R(this.a);return a};function Cf(){this.a=1;this.b=this.i=null;this.j=1;this.c=this.g=this.f=this.h=null}Cf.prototype.clone=function(){var a=new Cf;a.a=this.a;a.i=this.i;a.b=this.b;a.j=this.j;a.h=this.h;a.f=this.f;a.g=this.g;a.c=R(this.c);return a};function Df(){this.a=[]}Df.prototype.clone=function(){var a=new Df;a.a=xf(this.a)||[];return a};function Ef(){this.c=this.a=this.b=null}
Ef.prototype.clone=function(){var a=new Ef;a.b=this.b;a.a=this.a;a.c=this.c;return a};function Ff(a,b){this.na=a;this.end=b}Ff.prototype.clone=function(){return new Ff(this.na,this.end)};lf.TAG_NAME="MPD";mf.TAG_NAME="Period";nf.TAG_NAME="AdaptationSet";of.TAG_NAME="Role";pf.TAG_NAME="ContentComponent";qf.TAG_NAME="Representation";rf.TAG_NAME="ContentProtection";sf.TAG_NAME="cenc:pssh";tf.TAG_NAME="BaseURL";uf.TAG_NAME="Location";wf.TAG_NAME="SegmentBase";yf.TAG_NAME="RepresentationIndex";
zf.TAG_NAME="Initialization";Af.TAG_NAME="SegmentList";Bf.TAG_NAME="SegmentURL";Cf.TAG_NAME="SegmentTemplate";Df.TAG_NAME="SegmentTimeline";Ef.TAG_NAME="S";
lf.prototype.parse=function(a,b){this.url=a.hb;this.id=S(b,"id",T);this.type=S(b,"type",T)||"static";this.b=S(b,"mediaPresentationDuration",Gf);this.h=S(b,"minBufferTime",Gf,this.h);this.g=S(b,"minimumUpdatePeriod",Gf,this.g);this.c=S(b,"availabilityStartTime",Hf,this.c);this.f=S(b,"timeShiftBufferDepth",Gf,this.f);this.i=S(b,"suggestedPresentationDelay",Gf,this.i);var c=a.u,d=U(this,b,tf);this.u=If(c,d);if(d=V(this,b,uf))this.j=Jf(c,d.url);this.a=U(this,b,mf)};
mf.prototype.parse=function(a,b){this.id=S(b,"id",T);this.start=S(b,"start",Gf);this.a=S(b,"duration",Gf);var c=U(this,b,tf);this.u=If(a.u,c);this.c=V(this,b,wf);this.f=V(this,b,Af);this.g=V(this,b,Cf);this.b=U(this,b,nf);Kf(this)};function Kf(a){for(var b=[],c=0;c<a.b.length;++c){var d=a.b[c];null!=d.group&&(b[d.group]=!0)}for(c=0;c<a.b.length;++c)if(d=a.b[c],null==d.group){for(var e=1;1==b[e];)++e;b[e]=!0;d.group=e}}
nf.prototype.parse=function(a,b){var c=V(this,b,pf)||{},d=V(this,b,of);this.id=S(b,"id",T);this.group=S(b,"group",W);this.lang=S(b,"lang",T,c.lang);this.contentType=S(b,"contentType",T,c.contentType);this.width=S(b,"width",X);this.height=S(b,"height",X);this.b=S(b,"mimeType",T);this.i=S(b,"codecs",T);this.c=d&&"main"==d.value;this.lang&&(this.lang=Sa(this.lang));c=U(this,b,tf);this.u=If(a.u,c);this.j=U(this,b,rf);!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]);this.f=a.c?Lf(this,
b,a.c):V(this,b,wf);this.g=a.f?Lf(this,b,a.f):V(this,b,Af);this.h=a.g?Lf(this,b,a.g):V(this,b,Cf);this.a=U(this,b,qf);!this.b&&this.a.length&&(this.b=this.a[0].f,!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]))};of.prototype.parse=function(a,b){this.value=S(b,"value",T)};pf.prototype.parse=function(a,b){this.id=S(b,"id",T);this.lang=S(b,"lang",T);this.contentType=S(b,"contentType",T);this.lang&&(this.lang=Sa(this.lang))};
qf.prototype.parse=function(a,b){this.id=S(b,"id",T);this.bandwidth=S(b,"bandwidth",X);this.width=S(b,"width",X,a.width);this.height=S(b,"height",X,a.height);this.f=S(b,"mimeType",T,a.b);this.h=S(b,"codecs",T,a.i);this.lang=a.lang;var c=U(this,b,tf);this.u=If(a.u,c);this.c=U(this,b,rf);this.g=a.f?Lf(this,b,a.f):V(this,b,wf);this.b=a.g?Lf(this,b,a.g):V(this,b,Af);this.a=a.h?Lf(this,b,a.h):V(this,b,Cf);this.c=this.c.concat(a.j)};
rf.prototype.parse=function(a,b){this.f=b;this.c=S(b,"schemeIdUri",T);var c=S(b,"cenc:default_KID",T);c&&(this.b=c.replace(/[-]/g,""));this.a=V(this,b,sf)};sf.prototype.parse=function(a,b){var c=Mf(b);if(c){this.psshBox=sa(c);try{this.parsedPssh=new Rb(this.psshBox)}catch(d){if(!(d instanceof RangeError))throw d;}}};tf.prototype.parse=function(a,b){this.url=Mf(b)};uf.prototype.parse=function(a,b){this.url=Mf(b)};
wf.prototype.parse=function(a,b){this.u=a.u||this.u;this.g=S(b,"timescale",X,this.g);this.f=S(b,"presentationTimeOffset",W,this.f);this.a=S(b,"indexRange",Nf,this.a);this.b=V(this,b,yf)||this.b;this.c=V(this,b,zf)||this.c};yf.prototype.parse=function(a,b){var c=S(b,"sourceURL",T);this.url=Jf(a.u,c);this.a=S(b,"range",Nf,R(a.a))};zf.prototype.parse=function(a,b){var c=S(b,"sourceURL",T);this.url=Jf(a.u,c);this.a=S(b,"range",Nf)};
Af.prototype.parse=function(a,b){this.u=a.u||this.u;this.f=S(b,"timescale",X,this.f);this.g=S(b,"presentationTimeOffset",W,this.g);this.b=S(b,"duration",X,this.b);var c=S(b,"startNumber",X);null!=c&&(this.i=c);this.h=V(this,b,zf)||this.h;this.a=(c=U(this,b,Bf))&&0<c.length?c:this.a;this.c=V(this,b,Df)||this.c};Bf.prototype.parse=function(a,b){var c=S(b,"media",T);this.b=Jf(a.u,c);this.a=S(b,"mediaRange",Nf)};
Cf.prototype.parse=function(a,b){this.a=S(b,"timescale",X,this.a);this.i=S(b,"presentationTimeOffset",W,this.i);this.b=S(b,"duration",X,this.b);var c=S(b,"startNumber",W);null!=c&&(this.j=c);this.h=S(b,"media",T,this.h);this.f=S(b,"index",T,this.f);this.g=S(b,"initialization",T,this.g);this.c=V(this,b,Df)||this.c};Df.prototype.parse=function(a,b){this.a=U(this,b,Ef)};Ef.prototype.parse=function(a,b){this.b=S(b,"t",W);this.a=S(b,"d",W);this.c=S(b,"r",Of)};
function If(a,b){if(!b||0===b.length)return a;for(var c=[],d=0;d<b.length;d++){var e=b[d].url;null==a||0===a.length?c.push(new H(e)):(e=Jf(a.slice(0,1),e),c.push(e[0]))}return c}function Jf(a,b){if(!b)return a;var c=new H(b);return a?a.map(function(a){return a.resolve(c)}):[c]}function Lf(a,b,c){var d=R(c);(b=Pf(b,c.constructor.TAG_NAME))&&d.parse(a,b);return d}function V(a,b,c){var d=null;if(b=Pf(b,c.TAG_NAME))d=new c,d.parse(a,b);return d}
function Pf(a,b){for(var c=null,d=0;d<a.childNodes.length;d++)if(a.childNodes[d].tagName==b){if(c)return null;c=a.childNodes[d]}return c}function U(a,b,c){for(var d=[],e=0;e<b.childNodes.length;e++)if(b.childNodes[e].tagName==c.TAG_NAME){var f=new c;f.parse.call(f,a,b.childNodes[e]);d.push(f)}return d}function Mf(a){a=a.firstChild;return a.nodeType!=Node.TEXT_NODE?null:a.nodeValue}function xf(a){return a?a.map(function(a){return a.clone()}):null}function R(a){return a?a.clone():null}
function S(a,b,c,d){a=c(a.getAttribute(b));return null!=a?a:void 0!==d?d:null}function Hf(a){if(!a)return null;a=Date.parse(a);return isNaN(a)?null:Math.floor(a/1E3)}
function Gf(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);if(!b)return null;a=0;var c=W(b[1]);c&&(a+=31536E3*c);(c=W(b[2]))&&(a+=2592E3*c);(c=W(b[3]))&&(a+=86400*c);(c=W(b[4]))&&(a+=3600*c);(c=W(b[5]))&&(a+=60*c);b=window.parseFloat(b[6]);(b=isNaN(b)?null:b)&&(a+=b);return a}
function Nf(a){var b=/([0-9]+)-([0-9]+)/.exec(a);if(!b)return null;a=W(b[1]);if(null==a)return null;b=W(b[2]);return null==b?null:new Ff(a,b)}function Of(a){a=window.parseInt(a,10);return isNaN(a)?null:a}function X(a){a=window.parseInt(a,10);return 0<a?a:null}function W(a){a=window.parseInt(a,10);return 0<=a?a:null}function T(a){return a};function Qf(a,b,c,d){for(var e=b.a,f=[],g=0;g<d;++g){var h=g+c,l=(h-1)*e.b,m=l/e.a,n=(l+e.b)/e.a,h=kf(a,b,e.j+h-1,l);if(!h)return null;f.push(new nd(m,n,h))}return f}function kf(a,b,c,d){if(!b.a)return null;var e=b.a.h;if(!e)return b.u?new E(a,b.u,0,null):null;c=Rf(e,b.id,c,b.bandwidth,d);if(!c)return null;b=kd(b.u,c);return new E(a,b,0,null)}
function Rf(a,b,c,d,e){var f={RepresentationID:b,Number:c,Bandwidth:d,Time:e};a=a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(a,b,c){if("$$"==a)return"$";var d=f[b];if(null==d)return a;"RepresentationID"==b&&c&&(c=void 0);a=d.toString();c=window.parseInt(c,10)||1;c=Math.max(0,c-a.length);return Array(c+1).join("0")+a});try{return new H(a)}catch(g){if(g instanceof URIError)return null;throw g;}}
function jf(a,b,c){var d=0;b*=c;a=a.a;c=[];for(var e=0;e<a.length&&a[e].a;++e){var f=a[e].b,f=null!=f?f:d,g=a[e].c||0;0>g&&(g=a[e].a,g=e+1===a.length?Math.ceil((a[0].b+b-f)/g)-1:Math.ceil((a[e+1].b-f)/g)-1);0<c.length&&f!=d&&(c[c.length-1].end=f);for(var h=0;h<=g;++h)d=f+a[e].a,c.push({start:f,end:d}),f=d}return c};function Sf(a,b){this.a=new Cb;this.a.f="text";this.a.a=3;this.a.c=1E3*(null!=b?b:0);this.a.g=!0;this.b=a}function Tf(a){var b=a.b;return Db(b,a.a).then(function(a){var d;d=b.b;var e=[b.h];d=(a=(new DOMParser).parseFromString(a,"text/xml"))?V({hb:d,u:e},a,lf):null;if(d)return Promise.resolve(d);d=Error("MPD parse failure.");d.type="dash";return Promise.reject(d)})};function Uf(a,b,c,d,e){this.c=a;this.b=b;this.g=c;this.a=null;this.h=d;this.f=e}Uf.prototype.destroy=function(){this.f=this.g=this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null)};
Uf.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=this.g.b,b=[];a.c&&(b=jf(a.c,a.f||1,this.b.a||0));var c=0;a.b&&a.i?c=(a.i-1)*a.b:0<b.length&&(c=b[0].start-(a.g||0));var d=a.a.length;0<b.length&&b.length!=a.a.length&&(d=Math.min(b.length,a.a.length));for(var e=[],f=0;f<d;++f){var g=a.a[f],h=c/a.f,l=null,m=null;a.b?(l=c+a.b,m=l/a.f):0<b.length?(l=b[f].end-(a.g||0),m=l/a.f):(m=h+this.b.a,l=m*a.f);var c=l,l=0,n=null;g.a&&(l=g.a.na,n=g.a.end);e.push(new nd(h,m,new E(this.f,
g.b,l,n)))}"dynamic"==this.c.type?this.a=new Q(e,this.c,this.b,this.h):this.a=new J(e);return Promise.resolve(this.a)};function Vf(a,b,c,d,e){var f=1,g=0,h;if(a.c>d)h=null;else{var l=a.i||0,m=a.f||0;h=c.a;h=h.b/h.a;var n=d-(a.c+b.start);0>n?h=null:(m=n-2*h-m,0>m&&(m=0),m=Math.ceil(m/h)*h,n-=h,0>n?h=null:(l=Math.floor(n/h)*h-l,0>l&&(l=0),l=Math.floor(l/h)*h,h={Ya:m/h+1,current:(l>=m?l:m)/h+1}))}h&&(f=h.Ya,g=h.current-h.Ya+1);f=Qf(e,c,f,g);if(null==f)throw a=Error("Failed to generate SegmentReferences."),a.type="stream",a;Q.call(this,f,a,b,d);this.s=c;this.v=this.b=0<this.length()?a.c+b.start+this.A().a:null;this.j=
h?h.current+1:null;this.B=e}q(Vf,Q);Vf.prototype.destroy=function(){this.B=this.s=null;Q.prototype.destroy.call(this)};Vf.prototype.la=function(a){var b=Ha()/1E3;Wf(this,b);df(this,b);return J.prototype.la.call(this,a)};Vf.prototype.Ha=function(a){if(null!=this.b||!(a instanceof Vf)||null==a.b)return!1;this.b=a.b;this.v=a.v;this.j=a.j;this.f=a.f;this.h=a.h;sd(this,a);Wf(this,Ha()/1E3);cf(this);return!0};
Vf.prototype.ka=function(a){a=Q.prototype.ka.call(this,a);null!=this.b&&(this.b+=a,this.v+=a);return a};Vf.prototype.Ea=function(){var a=Ha()/1E3;Wf(this,a);return ff(this,a)};function Wf(a,b){if(null!=a.b&&null!=a.v&&null!=a.j){var c=a.s.a,c=c.b/c.a,d=Math.floor((a.v+(b-a.f)-a.b)/c);if(0!=d){var e=Qf(a.B,a.s,a.j,d);Array.prototype.push.apply(a.o,pd(e,a.i));a.b+=d*c;a.j+=d}}};function Xf(a,b,c,d,e){this.f=a;this.b=b;this.c=c;this.h=d;this.a=null;this.g=e}Xf.prototype.destroy=function(){this.g=this.c=this.b=this.f=null;this.a&&(this.a.destroy(),this.a=null)};
Xf.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.f.type)try{this.a=new Vf(this.f,this.b,this.c,this.h,this.g)}catch(a){return Promise.reject(a)}else{var b;b=this.c.a;if(b=Qf(this.g,this.c,1,Math.ceil(this.b.a/(b.b/b.a)))){if(0<b.length){var c=b[b.length-1];b[b.length-1]=od(c,c.b,this.b.a)}b=new J(b)}else b=null;this.a=b;if(!this.a)return b=Error("Failed to generate SegmentReferences"),b.type="stream",Promise.reject(b)}return Promise.resolve(this.a)};function Yf(a){this.a=a}
function Zf(a,b,c){for(var d=Ha()/1E3,e=0;e<b.a.length;++e)for(var f=b.a[e],g=0;g<f.b.length;++g){var h=f.b[g];if("text"!=h.contentType)for(var l=0;l<h.a.length;++l){var m=h.a[l],n=0,n=n+(m.g?1:0),n=n+(m.b?1:0),n=n+(m.a?1:0);0==n?(h.a.splice(l,1),--l):1!=n&&(m.g?(m.b=null,m.a=null):m.b&&(m.a=null))}}$f(b);for(e=0;e<b.a.length;++e)for(f=b.a[e],g=0;g<f.b.length;++g){l=h=f.b[g];m=null;for(n=0;n<l.a.length;++n){var t=l.a[n].f||"";m?t!=m&&(l.a.splice(n,1),--n):m=t}0==h.a.length&&(f.b.splice(g,1),--g)}"dynamic"==
b.type&&null==b.c&&(b.c=d);e=new Dd;"dynamic"==b.type&&(e.b=!0,e.f=b.g,e.g=new E(c,b.j||b.url),e.h=b.c);e.c=b.h||5;for(f=0;f<b.a.length;++f){g=b.a[f];if(null==g.start)break;g=ag(a,b,g,d,c);e.a.push(g)}return e}
function $f(a){if(a.a.length){null==a.a[0].start&&(a.a[0].start=0);var b=function(a){return 0==a||!!a};"dynamic"==a.type&&(a.b=null);b(a.b)&&1==a.a.length&&!b(a.a[0].a)&&(a.a[0].a=a.b);for(var c=0,d=!0,e=0;e<a.a.length;++e){var f=a.a[e-1],g=a.a[e],h=a.a[e+1]||{start:a.b};!b(g.start)&&f&&b(f.start)&&b(f.a)&&(g.start=f.start+f.a);!b(g.a)&&b(h.start)&&(g.a=h.start-g.start);null!=g.start&&null!=g.a?c+=g.a:d=!1}b(a.b)||(e=a.a[a.a.length-1],d?a.b=c:b(e.start)&&b(e.a)?a.b=e.start+e.a:"dynamic"!=a.type&&
(a.b=c))}}function ag(a,b,c,d,e){var f=new Cd;f.id=c.id;f.start=c.start;f.b=c.a;var g=new w;c.b.forEach(function(a){g.push(a.contentType||"",a)});for(var h=Ga(g),l=0;l<h.length;++l){var m=new w;g.get(h[l]).forEach(function(a){m.push(a.group,a)});for(var n=Ga(m),t=0;t<n.length;++t){var A=new w;m.get(n[t]).forEach(function(a){A.push(a.lang,a)});for(var M=Ga(A),I=0;I<M.length;++I){var pa=A.get(M[I]),pa=bg(a,b,c,pa,d,e);f.a.push(pa)}}}return f}
function bg(a,b,c,d,e,f){Ja(d.every(function(a){return a.group==d[0].group&&(a.lang||"")==(d[0].lang||"")&&(a.contentType||"")==(d[0].contentType||"")}));var g=new yd,h=d.filter(function(a){return null!=a.id});h.length==d.length&&(g.id=h.map(function(a){return a.id}).sort().reduce(function(a,b){return a+","+b}));g.lang=d[0].lang||"";g.contentType=d[0].contentType||"";g.b=d.some(function(a){return a.c});for(var h={},l=0;l<d.length;++l)for(var m=d[l],n=0;n<m.a.length;++n){var t=m.a[n],A=cg(a,t),M=g.a.slice(0);
dg(A,M);0==M.length&&0<g.a.length||!(t=eg(b,c,t,e,f))||(g.m.push(t),g.a=M,h[t.C]=m)}if(g.a.some(function(a){return""==a.a}))return g.m.forEach(function(a){a.N=!0}),g;a=fg(d);for(l=0;l<g.m.length;++l)t=g.m[l],m=h[t.C],m==a&&(t.N=!0);return g}function fg(a){for(var b=null,c=null,d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.a.length;++f){var g=e.a[f],g=(g.width||1)*(g.height||1)*(g.bandwidth||1);if(null==b||g<b)b=g,c=e}return c}
function dg(a,b){if(0==b.length)Array.prototype.push.apply(b,a);else for(var c=0;c<b.length;++c){for(var d=!1,e=0;e<a.length;++e){var f=b[c],g=a[e];if(f.a==g.a&&f.h==g.h&&f.i==g.i&&f.g==g.g&&f.v==g.v&&f.f==g.f&&f.j==g.j&&ua(f.c,g.c)){d=!0;Na(b[c],a[e].b);break}}d||(b.splice(c,1),--c)}}function cg(a,b){var c=[];if(0==b.c.length)c.push(new Ka);else if(a.a)for(var d=0;d<b.c.length;++d)c.push.apply(c,gg(a,b.c[d]));return c}
function gg(a,b){var c=[];if(2!=a.a.length)return[];var d=a.a(b.c||"",b.f);if(!(d&&d instanceof Array))return[];for(var e=0;e<d.length;++e){var f=La(d[e]);0==f.b.length&&b.a&&b.a.psshBox&&Na(f,[{initData:b.a.psshBox,initDataType:"cenc"}]);c.push(f)}return c}
function eg(a,b,c,d,e){if(!c.u||0===c.u.length)return null;var f=null,g=1,h=0;if(c.g)f=c.f.split("/")[1],"mp4"!=f&&"webm"!=f?f=null:(g=c.g,"webm"!=f||g.c?g.a||g.b&&g.b.a?(h=g.b,h||(h=new yf,h.url=c.u,h.a=g.a?g.a.clone():null),h=hg(h,e),g=g.c?hg(g.c,e):null,a=new gf(a,b,f,h,g,d,e),b=new md(g),d=new vd,d.I=a,d.H=b,f=d):f=null:f=null),g=c.g.g,h=c.g.f;else if(c.b)f=c.b,!f.b&&!f.c&&1<f.a.length?f=null:f.b||b.a||f.c||1!=f.a.length?f.c&&0===f.c.a.length?f=null:(f=f.h?hg(f.h,e):null,a=new Uf(a,b,c,d,e),b=
new md(f),d=new vd,d.I=a,d.H=b,f=d):f=null,g=c.b.f,h=c.b.g;else if(c.a){a:if(f=c.a,g=0+(f.f?1:0),g+=f.c?1:0,g+=f.b?1:0,0==g?g=!1:(1!=g&&(f.f?(f.c=null,f.b=null):f.c&&(f.b=null)),g=!0),g){g=null;if(f.g&&(g=(f=c.a.g)?ig(c,f,zf):null,!g)){f=null;break a}f=g?hg(g,e):null;g=c.a;g.f?(g=c.f.split("/")[1],"mp4"!=g&&"webm"!=g?a=null:"webm"!=g||f?kf(e,c,1,0)?(h=(h=c.a.f)?ig(c,h,yf):null)?(h=hg(h,e),a=new gf(a,b,g,h,f,d,e)):a=null:a=null:a=null):a=g.h?g.c?new hf(a,b,c,d,e):g.b?"dynamic"!=a.type&&null==b.a?null:
new Xf(a,b,c,d,e):null:null;a?(b=new md(f),d=new vd,d.I=a,d.H=b,f=d):f=null}else f=null;g=c.a.a;h=c.a.i}else"text"==c.f.split("/")[0]&&(f=new vd,f.I=new td(new E(e,c.u)));if(!f)return null;f.id=c.id;h&&(f.c=-1*h/g);f.bandwidth=c.bandwidth;f.width=c.width;f.height=c.height;f.a=c.f||"";f.b=c.h||"";for(a=0;a<c.c.length;++a)b=c.c[a],b.b&&f.f.push(b.b);return f}function ig(a,b,c){b=Rf(b,a.id,null,a.bandwidth,null);if(!b)return null;c=new c;c.url=kd(a.u,b);return c}
function hg(a,b){var c=a.url,d=0,e=null;a.a&&(d=a.a.na,e=a.a.end);return new E(b,c,d,e)};function Y(a,b,c){b||(b=new Xa);c||(c=new O);P.call(this,null,b,c);this.R=a;this.M=[];this.timeoutMs=3E4;this.l={};this.j=this.ga=null}q(Y,P);p("shaka.player.OfflineVideoSource",Y);Y.prototype.T=function(a){null!=a.licenseRequestTimeout&&(this.l.licenseRequestTimeout=a.licenseRequestTimeout);null!=a.segmentRequestTimeout&&(this.l.segmentRequestTimeout=a.segmentRequestTimeout);P.prototype.T.call(this,a)};
p("shaka.player.OfflineVideoSource.retrieveGroupIds",function(){var a=new rb,b=jb(a).then(function(){return sb(a)});b.then(function(){lb(a)}).catch(function(){lb(a)});return b});
Y.prototype.xa=function(a,b,c,d){var e,f=null,g={},h=[];a=new E(this.ga,[new H(a)]);return Tf(new Sf(a,this.da)).then(u(this,function(a){this.a=Zf(new Yf(c),a,this.ga);if(this.a.b)return a=Error("Unable to store live streams offline."),a.type="app",Promise.reject(a);this.T({preferredLanguage:b});return P.prototype.X.call(this)})).then(u(this,function(){var a=document.createElement("video");a.src=window.URL.createObjectURL(this.g);e=new L(null,a,this);null!=this.l.licenseRequestTimeout&&(e.w=Number(this.l.licenseRequestTimeout));
D(this.i,e,"sessionReady",this.ta.bind(this));D(this.i,e,"error",function(a){f=a});return e.initialize()})).then(u(this,function(){for(var a=Da(this.b),b=0;b<a.length;++b)for(var c=a[b],e=0;e<c.m.length;++e){var f=c.m[e];g[f.C]=f}return d()})).then(u(this,function(a){for(var b=0;b<a.length;++b){var c=a[b],d=g[c];if(d)h.push(d);else return Promise.reject(Error("Invalid stream ID chosen: "+c))}var e=["audio","video"];h=h.filter(function(a){return 0>e.indexOf(a.a.split("/")[0])?!1:!0});a=h.map(function(a){return a.H.create()});
return Promise.all(a)})).then(u(this,function(a){for(var b=h,c=[],d=0;d<b.length;++d)try{c[d]=this.g.addSourceBuffer(xd(b[d]))}catch(e){}if(b.length!=c.length)a=Error("Error initializing streams."),a.type="storage",a=Promise.reject(a);else{for(d=0;d<a.length;++d)(b=a[d])&&c[d].appendBuffer(b);a=Promise.resolve()}return a})).then(u(this,function(){return Vd(e,this.timeoutMs)})).then(u(this,function(){return f?Promise.reject(f):jg(this,h,e.a,this.a.a[0].b)})).then(u(this,function(a){this.R=a;return f?
(kg(this),Promise.reject(f)):Promise.resolve(a)}))};p("shaka.player.OfflineVideoSource.prototype.store",Y.prototype.xa);Y.prototype.Aa=function(a){this.ga=a};Y.prototype.setNetworkCallback=Y.prototype.Aa;Y.prototype.ta=function(a){this.M.push(a.detail.sessionId)};
function jg(a,b,c,d){var e=new We(a.Z,a);null!=a.l.segmentRequestTimeout&&(e.b=Number(a.l.segmentRequestTimeout));return jb(e).then(u(a,function(){return Xe(e,b,this.M,d,c)})).then(function(a){lb(e);return Promise.resolve(a)}).catch(function(a){lb(e);return Promise.reject(a)})}
Y.prototype.X=function(){var a=new rb,b,c;return jb(a).then(u(this,function(){return tb(a,this.R)})).then(u(this,function(d){var e=[];this.M=d.session_ids;b=d.duration;c={keySystem:d.key_system,distinctiveIdentifierRequired:d.distinctive_identifier,persistentStorageRequired:!0,audioRobustness:d.audio_robustness,videoRobustness:d.video_robustness,withCredentials:d.with_credentials,licenseServerUrl:d.license_server};for(var f=0;f<d.stream_ids.length;++f)e.push(ub(a,d.stream_ids[f]));return Promise.all(e)})).then(u(this,
function(a){var e=b,f=c,g=new Dd;g.c=5;for(var h=new Cd,l=0;l<a.length;++l){var m=a[l],n=new vd,t=new ud(m.references),A=new md(null,m.init_segment);n.I=t;n.H=A;n.a=m.mime_type;n.b=m.codecs;n.N=!0;this.j&&(null!=this.j.licenseServerUrl&&(f.licenseServerUrl=this.j.licenseServerUrl),null!=this.j.withCredentials&&(f.withCredentials=this.j.withCredentials),f.licensePostProcessor=this.j.licensePostProcessor,f.licensePreProcessor=this.j.licensePreProcessor,f.serverCertificate=this.j.serverCertificate);
m=La(f);t=new yd;t.m.push(n);t.a.push(m);t.contentType=n.a.split("/")[0];h.a.push(t);h.b=e}g.a.push(h);this.a=g;return P.prototype.X.call(this)})).then(function(){lb(a);return Promise.resolve()}).catch(function(b){lb(a);return Promise.eject(b)})};
Y.prototype.za=function(a,b){a&&(this.j={licenseServerUrl:a.licenseServerUrl,withCredentials:a.withCredentials,serverCertificate:a.serverCertificate,licensePreProcessor:a.licensePreProcessor,licensePostProcessor:a.licensePostProcessor});var c=null;return lg(this).catch(function(a){return b?(c=a,Promise.resolve()):Promise.reject(a)}).then(u(this,function(){return kg(this)})).then(function(){return Promise.resolve(c)})};Y.prototype.deleteGroup=Y.prototype.za;Y.prototype.ua=function(){return this.M};
Y.prototype.ha=function(){return!0};function kg(a){var b=new We(null,null);return jb(b).then(u(a,function(){return $e(b,this.R)})).then(function(){lb(b);return Promise.resolve()}).catch(function(a){lb(b);return Promise.reject(a)})}
function lg(a){var b=document.createElement("video");b.src=window.URL.createObjectURL(a.g);var c=new L(null,b,a);null!=a.l.licenseRequestTimeout&&(c.w=Number(a.l.licenseRequestTimeout));return a.X().then(function(){return c.initialize()}).then(u(a,function(){return Vd(c,this.timeoutMs)})).then(function(){return Wd(c)}).then(u(a,function(){c.destroy();this.destroy();return Promise.resolve()})).catch(u(a,function(a){c.destroy();this.destroy();return Promise.reject(a)}))};function Z(a,b,c,d){c||(c=new Xa);d||(d=new O);P.call(this,null,c,d);this.za=a;this.l=null;this.M=b;this.R=[];this.ga=[];this.ta=[];this.j=null}q(Z,P);p("shaka.player.DashVideoSource",Z);Z.prototype.Aa=function(a,b,c){this.R.push(a);this.ga.push(b||"");this.ta.push(c||"")};Z.prototype.addExternalCaptions=Z.prototype.Aa;Z.prototype.xa=function(a){this.j=a};Z.prototype.setNetworkCallback=Z.prototype.xa;Z.prototype.destroy=function(){this.l=this.j=this.M=null;P.prototype.destroy.call(this)};
Z.prototype.X=function(){var a=new E(this.j,[new H(this.za)]);return Tf(new Sf(a,this.da)).then(u(this,function(a){this.l=a;for(var c=0;c<this.R.length;c++){var d=a,e=this.R[c],f=this.ga[c],g=this.ta[c];if(0!==d.a.length){var h=new nf;h.contentType="text";h.lang=f||"en";h.c=!0;f=new qf;f.bandwidth=0;f.f=g||"text/vtt";f.u=[new H(e)];h.a.push(f);d.a[0].b.push(h);Kf(d.a[0])}}this.a=Zf(new Yf(this.M),a,this.j);return P.prototype.X.call(this)}))};
Z.prototype.fb=function(a){return Tf(new Sf(a,this.da)).then(u(this,function(a){this.l=a;a=Zf(new Yf(this.M),a,this.j);return Promise.resolve(a)}))};Z.prototype.eb=function(){var a=Zf(new Yf(this.M),this.l,this.j);return Promise.resolve(a)};}.bind(g,this))();
if (typeof(module)!="undefined"&&module.exports)module.exports=g.shaka;
else if (typeof(define)!="undefined" && define.amd)define(function(){return g.shaka});
else this.shaka=g.shaka;
})();
